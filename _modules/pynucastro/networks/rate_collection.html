
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pynucastro.networks.rate_collection &#8212; pynucastro 2.6.0.post44+gacc79aac0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/myfile.css?v=15ab05d9" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=4c6a0351"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=eaa7b67c"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/pynucastro/networks/rate_collection';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo.png" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="../../../_static/logo.png" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">pynucastro 2.6</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Overview of pynucastro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rate_types.html">Reaction Rate Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Nuclear Properties</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../sources.html">Third Party Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nucleus.html">Nuclear Properties</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">pynucastro Overview</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../pynucastro-examples.html">pynucastro Usage Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../plot-types.html">Plotting Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../basic_network.html">Basic Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pynucastro-integration.html">Integrating a Network</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Working with Libraries</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../library-examples.html">Selecting Rates from a Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tabulated-weak-rates.html">Tabulated Weak Rate Sources</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Building Networks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../duplicate-rates.html">Dealing with Duplicate Rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../validate-example.html">Checking Your Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../electron-capture-example.html">Tabulated Weak Rate Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../electron-captures.html">Combining ReacLib Rates with Electron Capture Tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../alternate-rates.html"><code class="docutils literal notranslate"><span class="pre">alternate_rates</span></code></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced Rate Operations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../screening-examples.html">Screening Rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modify-example.html">Modifying Rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../custom-rates.html">Creating a Custom Rate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../partition-function.html">Reverse Rates</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced Network Operations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../approximate-rates.html">Approximate and Modified Rates</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../alpha-gamma-approx.html">Approximating alpha-capture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../double-n-capture.html">Approximating double n-capture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modified-rates.html">Modified Rates</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nse-protons.html">Using NSE Protons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unimportant-rates.html">Removing Unimportant Rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../network-cycles.html">Finding Cycles (with NetworkX)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../stiffness.html">Assessing the Stiffness of a Network</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Nuclear Statistical Equilibrium</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../NSE-example.html">NSE Demonstrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nse_table.html">Creating an NSE table</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Plasma Neutrinos</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../neutrino-cooling.html">Neutrino Cooling</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Exporting Networks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../networks.html">Exporting Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../python-network.html">Python network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../simple-cxx-network.html">Simple C++ network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fortran-network.html">Fortran Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../amrex-astro-cxx-networks.html">AMReX Astro Microphysics Networks</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../julia.html">Integrating using DifferentialEquations.jl</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../installing-diffeqpy-julia.html">Installing <code class="docutils literal notranslate"><span class="pre">diffeqpy</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Example-Integrating-Network-diffeqpy.html">Example of Integrating a Network</a></li>

</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Some Useful Networks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../he-burning-example.html">A He-burning Network</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples in Nuclear Astrophysics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../examples/binding-energy.html">Binding Energy per Nucleon</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/pp-cno.html">p-p chain vs. CNO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/hot-CNO-breakout-example.html">hot-CNO and breakout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/triple_alpha_eval.html">Computing the Screened Triple-alpha rate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/he-burning.html">Ratio of C/O from He burning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/supernova-lightcurve.html">A Supernova Lightcurve</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../citing.html">Citing pynucastro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changes.html">Changelog</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../modules.html">API</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../pynucastro.html">pynucastro package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../pynucastro.constants.html">pynucastro.constants package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.constants.constants.html">pynucastro.constants.constants module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../pynucastro.networks.html">pynucastro.networks package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.networks.amrexastro_cxx_network.html">pynucastro.networks.amrexastro_cxx_network module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.networks.base_cxx_network.html">pynucastro.networks.base_cxx_network module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.networks.fortran_network.html">pynucastro.networks.fortran_network module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.networks.helper.html">pynucastro.networks.helper module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.networks.nse_network.html">pynucastro.networks.nse_network module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.networks.numpy_network.html">pynucastro.networks.numpy_network module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.networks.python_network.html">pynucastro.networks.python_network module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.networks.rate_collection.html">pynucastro.networks.rate_collection module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.networks.simple_cxx_network.html">pynucastro.networks.simple_cxx_network module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.networks.sympy_network_support.html">pynucastro.networks.sympy_network_support module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../pynucastro.neutrino_cooling.html">pynucastro.neutrino_cooling package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.neutrino_cooling.neutrino_cooling.html">pynucastro.neutrino_cooling.neutrino_cooling module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.neutrino_cooling.sneut5_mod.html">pynucastro.neutrino_cooling.sneut5_mod module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../pynucastro.nucdata.html">pynucastro.nucdata package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.nucdata.elements.html">pynucastro.nucdata.elements module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.nucdata.halflife_table.html">pynucastro.nucdata.halflife_table module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.nucdata.mass_table.html">pynucastro.nucdata.mass_table module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.nucdata.nucleus.html">pynucastro.nucdata.nucleus module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.nucdata.partition_function.html">pynucastro.nucdata.partition_function module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.nucdata.spin_table.html">pynucastro.nucdata.spin_table module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../pynucastro.rates.html">pynucastro.rates package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.rates.alternate_rates.html">pynucastro.rates.alternate_rates module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.rates.approximate_rates.html">pynucastro.rates.approximate_rates module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.rates.derived_rate.html">pynucastro.rates.derived_rate module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.rates.files.html">pynucastro.rates.files module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.rates.known_duplicates.html">pynucastro.rates.known_duplicates module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.rates.library.html">pynucastro.rates.library module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.rates.modified_rate.html">pynucastro.rates.modified_rate module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.rates.rate.html">pynucastro.rates.rate module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.rates.reaclib_rate.html">pynucastro.rates.reaclib_rate module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.rates.tabular_rate.html">pynucastro.rates.tabular_rate module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../pynucastro.reduction.html">pynucastro.reduction package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.reduction.drgep.html">pynucastro.reduction.drgep module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.reduction.generate_data.html">pynucastro.reduction.generate_data module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.reduction.load_network.html">pynucastro.reduction.load_network module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.reduction.reduction.html">pynucastro.reduction.reduction module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.reduction.reduction_utils.html">pynucastro.reduction.reduction_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.reduction.sensitivity_analysis.html">pynucastro.reduction.sensitivity_analysis module</a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../pynucastro.screening.html">pynucastro.screening package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.screening.screen.html">pynucastro.screening.screen module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../pynucastro.screening.screening_util.html">pynucastro.screening.screening_util module</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../../../pynucastro.numba_util.html">pynucastro.numba_util module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../pynucastro.yt_utils.html">pynucastro.yt_utils module</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zreferences.html">References</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Index</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../genindex.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../py-modindex.html">Module Index</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/pynucastro/pynucastro" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/pynucastro/pynucastro/issues/new?title=Issue%20on%20page%20%2F_modules/pynucastro/networks/rate_collection.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for pynucastro.networks.rate_collection</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;A collection of classes and methods to deal with collections of</span>
<span class="sd">rates that together make up a network.&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">collections</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">functools</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">operator</span><span class="w"> </span><span class="kn">import</span> <span class="n">mul</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">networkx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">interact</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">SymLogNorm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConnectionPatch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.scale</span><span class="w"> </span><span class="kn">import</span> <span class="n">SymmetricalLogTransform</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="kn">import</span> <span class="n">MaxNLocator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mpl_toolkits.axes_grid1</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.linalg</span><span class="w"> </span><span class="kn">import</span> <span class="n">eigvals</span>

<span class="c1"># Import Rate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pynucastro.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">constants</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pynucastro.nucdata</span><span class="w"> </span><span class="kn">import</span> <span class="n">Nucleus</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pynucastro.rates</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">ApproximateRate</span><span class="p">,</span> <span class="n">DerivedRate</span><span class="p">,</span> <span class="n">Library</span><span class="p">,</span>
                              <span class="n">ModifiedRate</span><span class="p">,</span> <span class="n">Rate</span><span class="p">,</span> <span class="n">RateFileError</span><span class="p">,</span> <span class="n">RatePair</span><span class="p">,</span>
                              <span class="n">TabularRate</span><span class="p">,</span> <span class="n">find_duplicate_rates</span><span class="p">,</span>
                              <span class="n">is_allowed_dupe</span><span class="p">,</span> <span class="n">load_rate</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pynucastro.rates.library</span><span class="w"> </span><span class="kn">import</span> <span class="n">_rate_name_to_nuc</span><span class="p">,</span> <span class="n">capitalize_rid</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pynucastro.screening</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">get_screening_map</span><span class="p">,</span> <span class="n">make_plasma_state</span><span class="p">,</span>
                                  <span class="n">make_screen_factors</span><span class="p">)</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># for plotting a legend on the network plot</span>
<span class="c1"># the tuple is (dZ, dN)</span>
<span class="n">RATE_LINES</span> <span class="o">=</span> <span class="p">{</span><span class="sa">r</span><span class="s2">&quot;$(\alpha, p)$&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
              <span class="sa">r</span><span class="s2">&quot;$(\alpha, \gamma)$&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
              <span class="sa">r</span><span class="s2">&quot;$(\alpha, n)$&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
              <span class="sa">r</span><span class="s2">&quot;$(p, \gamma)$&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
              <span class="sa">r</span><span class="s2">&quot;$(n, \gamma)$&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
              <span class="sa">r</span><span class="s2">&quot;$\beta^-$&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
              <span class="sa">r</span><span class="s2">&quot;$\beta^+$&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)}</span>


<div class="viewcode-block" id="RateDuplicationError">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateDuplicationError">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RateDuplicationError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An error of multiple rates linking the same nuclei occurred&quot;&quot;&quot;</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_skip_xalpha</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;utility function to consider if we show an (a, x) or (x, a) rate.  Here, p is the</span>
<span class="sd">    product we want to link to&quot;&quot;&quot;</span>

    <span class="c1"># first check if alpha is the heaviest nucleus on the RHS</span>
    <span class="n">rhs_heavy</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">products</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">rhs_heavy</span><span class="o">.</span><span class="n">Z</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">rhs_heavy</span><span class="o">.</span><span class="n">A</span> <span class="o">==</span> <span class="mi">4</span><span class="p">):</span>

        <span class="c1"># for rates that are A (x, alpha) B, where A and B are heavy nuclei,</span>
        <span class="c1"># don&#39;t show the connection of the nucleus to alpha, only show it to B</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">Z</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">A</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># likewise, hide A (alpha, x) B, unless A itself is an alpha</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">reactants</span>
        <span class="n">n_alpha</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nuc</span><span class="o">.</span><span class="n">Z</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">nuc</span><span class="o">.</span><span class="n">A</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">n_alpha</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># if there is only 1 alpha and we are working on the alpha node,</span>
        <span class="c1"># then skip</span>
        <span class="k">if</span> <span class="n">n_alpha</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">n</span><span class="o">.</span><span class="n">Z</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">n</span><span class="o">.</span><span class="n">A</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_skip_xp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;utility function to consider if we show an (p, x) or (x, p) rate.  Here, p is the</span>
<span class="sd">    product we want to link to&quot;&quot;&quot;</span>

    <span class="c1"># for rates that are A (x, p) B, where A and B are heavy nuclei,</span>
    <span class="c1"># don&#39;t show the connection of the nucleus to p, only show it to B</span>
    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">Z</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">A</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># likewise, hide A (p, x) B, unless A itself is an p</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">reactants</span>
    <span class="n">n_p</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nuc</span><span class="o">.</span><span class="n">Z</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">nuc</span><span class="o">.</span><span class="n">A</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">n_p</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># if there is only 1 p and we are working on the p node,</span>
    <span class="c1"># then skip</span>
    <span class="k">if</span> <span class="n">n_p</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">n</span><span class="o">.</span><span class="n">Z</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">n</span><span class="o">.</span><span class="n">A</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span>


<div class="viewcode-block" id="Composition">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.Composition">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Composition</span><span class="p">(</span><span class="n">collections</span><span class="o">.</span><span class="n">UserDict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a composition holds the mass fractions of the nuclei in a network</span>
<span class="sd">    -- useful for evaluating the rates</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    nuclei : list, tuple</span>
<span class="sd">        an iterable of Nucleus objects</span>
<span class="sd">    small : float</span>
<span class="sd">        a floor for nuclei mass fractions, used as the default value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nuclei</span><span class="p">,</span> <span class="n">small</span><span class="o">=</span><span class="mf">1.e-16</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">({</span><span class="n">Nucleus</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">k</span><span class="p">):</span> <span class="n">small</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nuclei</span><span class="p">})</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;must supply an iterable of Nucleus objects or strings&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">X</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;backwards-compatible getter for self.X&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="nd">@X</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">X</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;backwards-compatible setter for self.X&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">new_value</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="n">Nucleus</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">Nucleus</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">Nucleus</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Composition(&quot;</span> <span class="o">+</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  X(</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">) : </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">A</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Nucleus molar masses</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A : dict</span>
<span class="sd">            {Nucleus : A} pairs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">A</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">Z</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Nucleus charge</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Z : dict</span>
<span class="sd">            {Nucleus : Z} pairs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="n">n</span><span class="o">.</span><span class="n">Z</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">}</span>

<div class="viewcode-block" id="Composition.get_nuclei">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.Composition.get_nuclei">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of Nuclei objects that make up this composition.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Composition.get_molar">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.Composition.get_molar">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_molar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a dictionary of molar fractions, Y = X/A</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        molar : dict</span>
<span class="sd">            {Nucleus : Y}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">/</span><span class="n">k</span><span class="o">.</span><span class="n">A</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></div>


<div class="viewcode-block" id="Composition.get_sum_X">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.Composition.get_sum_X">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_sum_X</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return the sum of the mass fractions</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">fsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">())</span></div>


<div class="viewcode-block" id="Composition.set_solar_like">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.Composition.set_solar_like">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_solar_like</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="mf">0.02</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Approximate a solar abundance, setting p to 0.7, He4 to 0.3</span>
<span class="sd">        - Z and the remainder evenly distributed with Z</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Z : float</span>
<span class="sd">            The desired metalicity</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rem</span> <span class="o">=</span> <span class="n">Z</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.7</span>
            <span class="k">elif</span> <span class="n">k</span><span class="o">.</span><span class="n">raw</span> <span class="o">==</span> <span class="s2">&quot;he4&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="o">-</span> <span class="n">Z</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">rem</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span></div>


<div class="viewcode-block" id="Composition.set_array">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.Composition.set_array">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the mass fractions of all species to the values</span>
<span class="sd">        in arr, `get_nuclei()`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        arr : list, tuple, numpy.ndarray</span>
<span class="sd">            input values of mass fractions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>


<div class="viewcode-block" id="Composition.set_all">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.Composition.set_all">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xval</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set all species to the same scalar value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xval : float</span>
<span class="sd">            mass fraction value for all species</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">xval</span></div>


<div class="viewcode-block" id="Composition.set_equal">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.Composition.set_equal">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set all species to be equal&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_all</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span></div>


<div class="viewcode-block" id="Composition.set_random">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.Composition.set_random">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_random</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set all species using a Dirichlet distribution with</span>
<span class="sd">        parameters alpha and specified rng seed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        alpha : list, tuple, numpy.ndarray</span>
<span class="sd">            distribution length for the Dirichlet distribution</span>
<span class="sd">        seed : float</span>
<span class="sd">            seed for the random number generator</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># initializes random seed</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

        <span class="c1"># default is a flat Dirichlet distribution</span>
        <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="n">fracs</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">dirichlet</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">fracs</span><span class="p">)</span>

        <span class="c1"># ensures exact normalization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span></div>


<div class="viewcode-block" id="Composition.set_nuc">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.Composition.set_nuc">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_nuc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">xval</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set nuclei name to the mass fraction xval</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : Nucleus</span>
<span class="sd">            the nucleus to set</span>
<span class="sd">        xval: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">xval</span></div>


<div class="viewcode-block" id="Composition.normalize">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.Composition.normalize">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize the mass fractions to sum to 1 &quot;&quot;&quot;</span>
        <span class="n">X_sum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sum_X</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/=</span> <span class="n">X_sum</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ye</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the electron fraction of the composition</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">electron_frac</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fsum</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">Z</span> <span class="o">/</span> <span class="n">n</span><span class="o">.</span><span class="n">A</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sum_X</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">electron_frac</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">abar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the mean molecular weight</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">abar</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fsum</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">/</span> <span class="n">n</span><span class="o">.</span><span class="n">A</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">abar</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">zbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the mean charge, Zbar</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">abar</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ye</span>

<div class="viewcode-block" id="Composition.bin_as">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.Composition.bin_as">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">bin_as</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nuclei</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a list of nuclei, return a new Composition object</span>
<span class="sd">        with the current composition mass fractions binned into the</span>
<span class="sd">        new nuclei.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nuclei : list</span>
<span class="sd">            Input nuclei (either as string names or</span>
<span class="sd">            Nucleus objects) defining the new composition.</span>
<span class="sd">        verbose : bool</span>
<span class="sd">            Output more information</span>
<span class="sd">        exclude : bool</span>
<span class="sd">            List of nuclei in `nuclei` that only</span>
<span class="sd">            exact matches from the original composition can</span>
<span class="sd">            map into</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new_composition : Composition</span>
<span class="sd">            The new binned composition</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nuclei</span> <span class="o">=</span> <span class="n">Nucleus</span><span class="o">.</span><span class="n">cast_list</span><span class="p">(</span><span class="n">nuclei</span><span class="p">)</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="n">Nucleus</span><span class="o">.</span><span class="n">cast_list</span><span class="p">(</span><span class="n">exclude</span><span class="p">,</span> <span class="n">allow_None</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># sort the input nuclei by A, then Z</span>
        <span class="n">nuclei</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">Z</span><span class="p">))</span>

        <span class="c1"># create the new composition</span>
        <span class="n">new_comp</span> <span class="o">=</span> <span class="n">Composition</span><span class="p">(</span><span class="n">nuclei</span><span class="p">)</span>

        <span class="c1"># first do any exact matches if we provided an exclude list</span>
        <span class="k">if</span> <span class="n">exclude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">ex_nuc</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">:</span>
            <span class="c1"># if the exclude nucleus is in both our original</span>
            <span class="c1"># composition and the reduced composition, then set</span>
            <span class="c1"># the abundance in the new, reduced composition and</span>
            <span class="c1"># remove the nucleus from consideration for the other</span>
            <span class="c1"># original nuclei</span>
            <span class="k">if</span> <span class="n">ex_nuc</span> <span class="ow">in</span> <span class="n">nuclei</span> <span class="ow">and</span> <span class="n">ex_nuc</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">nuclei</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ex_nuc</span><span class="p">)</span>
                <span class="n">new_comp</span><span class="p">[</span><span class="n">ex_nuc</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">ex_nuc</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;storing </span><span class="si">{</span><span class="n">ex_nuc</span><span class="si">}</span><span class="s2"> as </span><span class="si">{</span><span class="n">ex_nuc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cannot use exclude if nucleus is not present in both the original and new compostion&quot;</span><span class="p">)</span>

        <span class="c1"># loop over our original nuclei.  Find the new nucleus such</span>
        <span class="c1"># that n_orig.A &gt;= n_new.A.  If there are multiple, then do</span>
        <span class="c1"># the same for Z</span>
        <span class="k">for</span> <span class="n">old_n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="n">old_n</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">:</span>
                <span class="c1"># we should have already dealt with this above</span>
                <span class="k">continue</span>

            <span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">nuclei</span> <span class="k">if</span> <span class="n">old_n</span><span class="o">.</span><span class="n">A</span> <span class="o">&gt;=</span> <span class="n">q</span><span class="o">.</span><span class="n">A</span><span class="p">]</span>
            <span class="c1"># if candidates is empty, then all of the nuclei are heavier than</span>
            <span class="c1"># old_n, so just put its composition in the first new nucleus</span>
            <span class="c1"># (which will be the lightest)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">candidates</span><span class="p">:</span>
                <span class="n">match_nuc</span> <span class="o">=</span> <span class="n">nuclei</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_A</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">A</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">)</span>
                <span class="n">match_A</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">candidates</span> <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">A</span> <span class="o">==</span> <span class="n">max_A</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match_A</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">match_Z</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">match_A</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span> <span class="k">if</span> <span class="n">old_n</span><span class="o">.</span><span class="n">Z</span> <span class="o">&gt;=</span> <span class="n">q</span><span class="o">.</span><span class="n">Z</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">match_Z</span><span class="p">:</span>
                        <span class="c1"># our nucleus has a Z less than any of the Z&#39;s in match_A</span>
                        <span class="n">match_nuc</span> <span class="o">=</span> <span class="n">match_A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># always take the last entry -- this way if</span>
                        <span class="c1"># match_Z has multiple nuclei, we are taking</span>
                        <span class="c1"># the one with the highest Z (since we</span>
                        <span class="c1"># initially sorted by A and Z)</span>
                        <span class="n">match_nuc</span> <span class="o">=</span> <span class="n">match_Z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">match_nuc</span> <span class="o">=</span> <span class="n">match_A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;storing </span><span class="si">{</span><span class="n">old_n</span><span class="si">}</span><span class="s2"> as </span><span class="si">{</span><span class="n">match_nuc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">new_comp</span><span class="p">[</span><span class="n">match_nuc</span><span class="p">]</span> <span class="o">+=</span> <span class="n">v</span>

        <span class="k">return</span> <span class="n">new_comp</span></div>


<div class="viewcode-block" id="Composition.plot">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.Composition.plot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace_threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hard_limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a pie chart of Composition. group trace nuclei</span>
<span class="sd">        together and explode into bar chart</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trace_threshold : float</span>
<span class="sd">            the threshold to consider a component to be trace.</span>
<span class="sd">        hard_limit : float</span>
<span class="sd">            limit below which an abundance will not be included</span>
<span class="sd">            in the trace nuclei wedget of the plot.</span>
<span class="sd">        size: tuple</span>
<span class="sd">            width, height of the plot in inches</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.figure.Figure</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># find trace nuclei</span>
        <span class="n">trace_keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">trace_tot</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">main_keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># if below threshold, count as trace element</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">trace_threshold</span><span class="p">:</span>
                <span class="n">trace_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">trace_tot</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">main_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="c1"># check if any trace nuclei</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">trace_keys</span><span class="p">:</span>
            <span class="c1"># just do pie chart without including trace</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">autopct</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">p</span><span class="o">/</span><span class="mi">100</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># find trace nuclei which contribute little to trace proportion</span>
            <span class="k">if</span> <span class="n">hard_limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># make hardlimit proportional to trace abundance</span>
                <span class="n">hard_limit</span> <span class="o">=</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">trace_tot</span>

            <span class="n">limited_trace_keys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">other_trace_tot</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">trace_keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">hard_limit</span><span class="p">:</span>
                    <span class="n">other_trace_tot</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">limited_trace_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

            <span class="c1"># make figure and assign axis objects</span>
            <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># pie chart parameters</span>
            <span class="n">main_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">trace_tot</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">main_keys</span><span class="p">]</span>
            <span class="n">main_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;trace&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">main_keys</span>
            <span class="n">explode</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mf">0.</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">main_keys</span><span class="p">))]</span>

            <span class="c1"># rotate so that first wedge is split by the x-axis</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span> <span class="o">*</span> <span class="n">main_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">wedges</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">main_values</span><span class="p">,</span> <span class="n">autopct</span><span class="o">=</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">p</span><span class="o">/</span><span class="mi">100</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span>
                                <span class="n">labels</span><span class="o">=</span><span class="n">main_labels</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="n">explode</span><span class="p">)</span>

            <span class="c1"># bar chart parameters</span>
            <span class="n">trace_values</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">limited_trace_keys</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">other_trace_tot</span><span class="p">]</span>
            <span class="n">trace_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">limited_trace_keys</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;other&#39;</span><span class="p">]</span>
            <span class="n">bottom</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">width</span> <span class="o">=</span> <span class="mf">0.1</span>

            <span class="c1"># Adding from the top matches the legend.</span>
            <span class="n">alpha_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace_values</span><span class="p">))</span>
            <span class="n">trace_wedge_color</span> <span class="o">=</span> <span class="n">wedges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="o">*</span><span class="nb">zip</span><span class="p">(</span><span class="n">trace_values</span><span class="p">,</span> <span class="n">trace_labels</span><span class="p">)]):</span>
                <span class="n">bottom</span> <span class="o">-=</span> <span class="n">height</span>
                <span class="n">bc</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="n">bottom</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">trace_wedge_color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha_list</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

                <span class="n">ax2</span><span class="o">.</span><span class="n">bar_label</span><span class="p">(</span><span class="n">bc</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">height</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span> <span class="n">label_type</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                <span class="n">ax2</span><span class="o">.</span><span class="n">bar_label</span><span class="p">(</span><span class="n">bc</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">:</span><span class="s2">&gt;30</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span> <span class="n">label_type</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

            <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Composition of Trace Nuclei&#39;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">width</span><span class="p">,</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">width</span><span class="p">)</span>

            <span class="c1"># use ConnectionPatch to draw lines between the two plots</span>
            <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span> <span class="o">=</span> <span class="n">wedges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">theta1</span><span class="p">,</span> <span class="n">wedges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">theta2</span>
            <span class="n">center</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">wedges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">center</span><span class="p">,</span> <span class="n">wedges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">r</span>
            <span class="n">bar_height</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">trace_values</span><span class="p">)</span>

            <span class="c1"># draw top connecting line</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">theta2</span><span class="p">)</span> <span class="o">+</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">theta2</span><span class="p">)</span> <span class="o">+</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">con</span> <span class="o">=</span> <span class="n">ConnectionPatch</span><span class="p">(</span><span class="n">xyA</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">bar_height</span><span class="o">+</span><span class="n">bottom</span><span class="p">),</span> <span class="n">coordsA</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span>
                                <span class="n">xyB</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">coordsB</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transData</span><span class="p">)</span>
            <span class="n">con</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">trace_wedge_color</span><span class="p">)</span>
            <span class="n">con</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>

            <span class="c1"># draw bottom connecting line</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">theta1</span><span class="p">)</span> <span class="o">+</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">theta1</span><span class="p">)</span> <span class="o">+</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">con</span> <span class="o">=</span> <span class="n">ConnectionPatch</span><span class="p">(</span><span class="n">xyA</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">bottom</span><span class="p">),</span> <span class="n">coordsA</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span>
                                <span class="n">xyB</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">coordsB</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transData</span><span class="p">)</span>
            <span class="n">con</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">trace_wedge_color</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>
            <span class="n">con</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fig</span></div>
</div>



<div class="viewcode-block" id="RateCollection">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RateCollection</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A collection of rates that together define a network.</span>
<span class="sd">    There are several arguments to the constructor -- any combination</span>
<span class="sd">    may be supplied.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rate_files : str, list, tuple</span>
<span class="sd">        a string or iterable of strings of file names that define valid</span>
<span class="sd">        rates. This can include Reaclib library files storing multiple</span>
<span class="sd">        rates.</span>
<span class="sd">    libraries : Library, list, tuple</span>
<span class="sd">        a Library or iterable of Library objects</span>
<span class="sd">    rates : Rate, list, tuple</span>
<span class="sd">        a Rate or iterable of Rate objects</span>
<span class="sd">    inert_nuclei : list, tuple</span>
<span class="sd">        an iterable of Nuclei that should be part of the collection but</span>
<span class="sd">        are not linked via reactions to the other Nuclei in the network.</span>
<span class="sd">    symmetric_screening : bool</span>
<span class="sd">        symmetric screening means that we screen the reverse rates</span>
<span class="sd">        using the same factor as the forward rates, for rates computed</span>
<span class="sd">        via detailed balance.</span>
<span class="sd">    do_screening : bool</span>
<span class="sd">        should we consider screening at all -- this mainly affects</span>
<span class="sd">        whether we build the screening map</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pynucastro_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rate_files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">libraries</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">inert_nuclei</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">symmetric_screening</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_screening</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">combined_library</span> <span class="o">=</span> <span class="n">Library</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inert_nuclei</span> <span class="o">=</span> <span class="n">Nucleus</span><span class="o">.</span><span class="n">cast_list</span><span class="p">(</span><span class="n">inert_nuclei</span><span class="p">,</span> <span class="n">allow_None</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">symmetric_screening</span> <span class="o">=</span> <span class="n">symmetric_screening</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_screening</span> <span class="o">=</span> <span class="n">do_screening</span>

        <span class="k">if</span> <span class="n">rate_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rate_files</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">rate_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">rate_files</span><span class="p">]</span>
            <span class="n">combined_library</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_rate_files</span><span class="p">(</span><span class="n">rate_files</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rates</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rates</span><span class="p">,</span> <span class="n">Rate</span><span class="p">):</span>
                <span class="n">rates</span> <span class="o">=</span> <span class="p">[</span><span class="n">rates</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rates</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">Rate</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Expected Rate object or list of Rate objects passed as the rates argument.&#39;</span><span class="p">)</span>
            <span class="n">rlib</span> <span class="o">=</span> <span class="n">Library</span><span class="p">(</span><span class="n">rates</span><span class="o">=</span><span class="n">rates</span><span class="p">)</span>
            <span class="n">combined_library</span> <span class="o">+=</span> <span class="n">rlib</span>

        <span class="k">if</span> <span class="n">libraries</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">libraries</span><span class="p">,</span> <span class="n">Library</span><span class="p">):</span>
                <span class="n">libraries</span> <span class="o">=</span> <span class="p">[</span><span class="n">libraries</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">lib</span> <span class="ow">in</span> <span class="n">libraries</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="n">Library</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Expected Library object or list of Library objects passed as the libraries argument.&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">lib</span> <span class="ow">in</span> <span class="n">libraries</span><span class="p">:</span>
                <span class="n">combined_library</span> <span class="o">+=</span> <span class="n">lib</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="o">+</span> <span class="n">combined_library</span><span class="o">.</span><span class="n">get_rates</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_build_collection</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># get the unique nuclei</span>
        <span class="n">u</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">reactants</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">products</span><span class="p">)</span>
            <span class="n">u</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

        <span class="c1"># approx nuclei are used in approximate rates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">approx_nuclei</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">ApproximateRate</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">intermediate_nucleus</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">approx_nuclei</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">approx_nuclei</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">intermediate_nucleus</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inert_nuclei</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inert_nuclei</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">nuc</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>

        <span class="c1"># now make a list of each rate that touches each nucleus</span>
        <span class="c1"># we&#39;ll store this in a dictionary keyed on the nucleus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_consumed</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_produced</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_consumed</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">reactants</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_produced</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">products</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_rate_pairs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">_rp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rate_pairs</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_rate_pairs</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> \
                <span class="p">[</span><span class="n">rp</span> <span class="k">for</span> <span class="n">rp</span> <span class="ow">in</span> <span class="n">_rp</span> <span class="k">if</span> <span class="n">rp</span><span class="o">.</span><span class="n">forward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">rp</span><span class="o">.</span><span class="n">forward</span><span class="o">.</span><span class="n">reactants</span> <span class="o">+</span> <span class="n">rp</span><span class="o">.</span><span class="n">forward</span><span class="o">.</span><span class="n">products</span> <span class="ow">or</span>
                                     <span class="n">rp</span><span class="o">.</span><span class="n">reverse</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">rp</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">reactants</span> <span class="o">+</span> <span class="n">rp</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">products</span><span class="p">]</span>

        <span class="c1"># Re-order self.rates so Reaclib rates come first,</span>
        <span class="c1"># followed by Tabular rates. This is needed if</span>
        <span class="c1"># reaclib coefficients are targets of a pointer array.</span>
        <span class="c1"># It is desired to avoid wasting array size</span>
        <span class="c1"># storing meaningless Tabular coefficient pointers.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">,</span>
                            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">chapter</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tabular_rates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reaclib_rates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">custom_rates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">approx_rates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derived_rates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modified_rates</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">ApproximateRate</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">approx_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cr</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">get_child_rates</span><span class="p">():</span>
                    <span class="k">assert</span> <span class="n">cr</span><span class="o">.</span><span class="n">chapter</span> <span class="o">!=</span> <span class="s2">&quot;t&quot;</span>

                    <span class="c1"># Check whether this child rate is removed or not.</span>
                    <span class="c1"># &quot;removed&quot; means that this rate is never used on</span>
                    <span class="c1"># its own to connect two nuclei in the network it</span>
                    <span class="c1"># is only used in one or more ApproximateRate or</span>
                    <span class="c1"># ModifiedRate</span>
                    <span class="k">if</span> <span class="n">cr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">:</span>
                        <span class="n">cr</span><span class="o">.</span><span class="n">removed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cr</span><span class="o">.</span><span class="n">removed</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="n">cr</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="c1"># pylint: disable-next=protected-access</span>
                    <span class="n">cr</span><span class="o">.</span><span class="n">_set_print_representation</span><span class="p">()</span>

                    <span class="c1"># child rates may be ReacLibRates, ModifiedRates,</span>
                    <span class="c1"># or DerivedRates.  Make sure we don&#39;t double</span>
                    <span class="c1"># count</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">DerivedRate</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">cr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_rates</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">derived_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">ModifiedRate</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">cr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modified_rates</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">modified_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reaclib_rates</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">reaclib_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">ModifiedRate</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modified_rates</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">modified_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

                <span class="n">cr</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">original_rate</span>

                <span class="c1"># Check whether this child rate is removed or not.</span>
                <span class="c1"># &quot;removed&quot; means that this rate is never used on</span>
                <span class="c1"># its own to connect two nuclei in the network it</span>
                <span class="c1"># is only used in one or more ApproximateRate or</span>
                <span class="c1"># ModifiedRate</span>
                <span class="k">if</span> <span class="n">cr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">:</span>
                    <span class="n">cr</span><span class="o">.</span><span class="n">removed</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cr</span><span class="o">.</span><span class="n">removed</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="n">cr</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="c1"># pylint: disable-next=protected-access</span>
                <span class="n">cr</span><span class="o">.</span><span class="n">_set_print_representation</span><span class="p">()</span>

                <span class="c1"># child rates may be ReacLibRates, ModifiedRates,</span>
                <span class="c1"># or DerivedRates.  Make sure we don&#39;t double</span>
                <span class="c1"># count</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">DerivedRate</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">cr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_rates</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">derived_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">ModifiedRate</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">cr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modified_rates</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">modified_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reaclib_rates</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">reaclib_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">r</span><span class="o">.</span><span class="n">chapter</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tabular_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">r</span><span class="o">.</span><span class="n">chapter</span> <span class="o">==</span> <span class="s2">&quot;custom&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">custom_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">DerivedRate</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_rates</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">derived_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">chapter</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reaclib_rates</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reaclib_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="s2">&quot;n --&gt; p &lt;wc12_reaclib_weak_&gt;&quot;</span><span class="p">:</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;ReacLib neutron decay rate (&lt;n_to_p_weak_wc12&gt;) does not account for degeneracy at high densities. Consider using tabular rate from Langanke.&quot;</span>
                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chapter type unknown for rate chapter </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">chapter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">all_rates</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reaclib_rates</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_rates</span> <span class="o">+</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">tabular_rates</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">approx_rates</span> <span class="o">+</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">modified_rates</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_rates</span><span class="p">)</span>

        <span class="c1"># finally check for duplicate rates -- these are not</span>
        <span class="c1"># allowed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_duplicate_links</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">RateDuplicationError</span><span class="p">(</span><span class="s2">&quot;Duplicate rates found&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_read_rate_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rate_files</span><span class="p">):</span>
        <span class="c1"># get the rates</span>
        <span class="n">combined_library</span> <span class="o">=</span> <span class="n">Library</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">rf</span> <span class="ow">in</span> <span class="n">rate_files</span><span class="p">:</span>
            <span class="c1"># create the appropriate rate object first</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rate</span> <span class="o">=</span> <span class="n">load_rate</span><span class="p">(</span><span class="n">rf</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">RateFileError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RateFileError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading rate from file: </span><span class="si">{</span><span class="n">rf</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">ex</span>

            <span class="c1"># now create a library:</span>
            <span class="n">rflib</span> <span class="o">=</span> <span class="n">Library</span><span class="p">(</span><span class="n">rates</span><span class="o">=</span><span class="p">[</span><span class="n">rate</span><span class="p">])</span>
            <span class="n">combined_library</span> <span class="o">+=</span> <span class="n">rflib</span>
        <span class="k">return</span> <span class="n">combined_library</span>

<div class="viewcode-block" id="RateCollection.get_forward_rates">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.get_forward_rates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_forward_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of the forward (exothermic) rates in the</span>
<span class="sd">        network</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list(Rate)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># first handle the ones that have Q defined</span>
        <span class="n">forward_rates</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">Q</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">forward_rates</span></div>


<div class="viewcode-block" id="RateCollection.get_reverse_rates">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.get_reverse_rates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_reverse_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of the reverse (endothermic) rates).  Note</span>
<span class="sd">        these may not be the same as the reverse rates identified by</span>
<span class="sd">        ReacLib.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list(Rate)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># first handle the ones that have Q defined</span>
        <span class="n">reverse_rates</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">Q</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">reverse_rates</span></div>


<div class="viewcode-block" id="RateCollection.find_reverse">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.find_reverse">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forward_rate</span><span class="p">,</span> <span class="n">reverse_rates</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a forward rate, locate the rate that is its reverse.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Rate</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">reverse_rates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">reverse_rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reverse_rates</span><span class="p">()</span>

        <span class="n">reverse</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">reverse_rates</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">forward_rate</span><span class="o">.</span><span class="n">reactants</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">A</span><span class="p">)</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rr</span><span class="o">.</span><span class="n">products</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">A</span><span class="p">)</span> <span class="ow">and</span> \
               <span class="nb">sorted</span><span class="p">(</span><span class="n">forward_rate</span><span class="o">.</span><span class="n">products</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">A</span><span class="p">)</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rr</span><span class="o">.</span><span class="n">reactants</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">A</span><span class="p">):</span>
                <span class="n">reverse</span> <span class="o">=</span> <span class="n">rr</span>
                <span class="k">break</span>

        <span class="k">return</span> <span class="n">reverse</span></div>


<div class="viewcode-block" id="RateCollection.get_rate_pairs">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.get_rate_pairs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_rate_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find pairs of forward (Q &gt; 0) and reverse (Q &lt; 0) rates for the</span>
<span class="sd">        same link between nuclei.</span>

<span class="sd">        Return</span>
<span class="sd">        ------</span>
<span class="sd">        list(RatePair)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rate_pairs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">reverse_rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_reverse_rates</span><span class="p">()</span>

        <span class="c1"># loop over all the forward rates and find the matching reverse rate</span>
        <span class="c1"># if it exists</span>
        <span class="k">for</span> <span class="n">fr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_forward_rates</span><span class="p">():</span>
            <span class="n">rp</span> <span class="o">=</span> <span class="n">RatePair</span><span class="p">(</span><span class="n">forward</span><span class="o">=</span><span class="n">fr</span><span class="p">)</span>

            <span class="n">rr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_reverse</span><span class="p">(</span><span class="n">fr</span><span class="p">,</span> <span class="n">reverse_rates</span><span class="o">=</span><span class="n">reverse_rates</span><span class="p">)</span>

            <span class="c1"># since we found a match, remove the reverse rate we paired</span>
            <span class="c1"># from out list so no other forward rate can match with it</span>
            <span class="k">if</span> <span class="n">rr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rp</span><span class="o">.</span><span class="n">reverse</span> <span class="o">=</span> <span class="n">rr</span>
                <span class="n">reverse_rates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">reverse</span><span class="p">)</span>

            <span class="n">rate_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>

        <span class="c1"># we might have some reverse rates remaining for which there</span>
        <span class="c1"># were no forward rates -- add those now</span>
        <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">reverse_rates</span><span class="p">:</span>
            <span class="n">rp</span> <span class="o">=</span> <span class="n">RatePair</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="n">rr</span><span class="p">)</span>
            <span class="n">rate_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rate_pairs</span></div>


<div class="viewcode-block" id="RateCollection.get_nuclei">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.get_nuclei">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all the nuclei that are part of the network.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list(Nucleus)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span></div>


<div class="viewcode-block" id="RateCollection.linking_nuclei">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.linking_nuclei">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">linking_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nuclei</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a new network containing only rates linking the</span>
<span class="sd">        given nuclei.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nuclei : list, tuple</span>
<span class="sd">            An iterable of Nucleus objects or string names of nuclei.</span>
<span class="sd">        return_type : Callable</span>
<span class="sd">            A different constructor (e.g., a superclass constructor)</span>
<span class="sd">            to use if the current class does not take a `libraries`</span>
<span class="sd">            keyword.</span>
<span class="sd">        kwargs : dict</span>
<span class="sd">            Additional arguments to pass onto the library linking_nuclei</span>
<span class="sd">            method.  See :py:mod:`pynucastro.rates.library.Library.linking_nuclei`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        RateCollection</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">return_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">return_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">lib</span> <span class="o">=</span> <span class="n">Library</span><span class="p">(</span><span class="n">rates</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">return_type</span><span class="p">(</span><span class="n">libraries</span><span class="o">=</span><span class="n">lib</span><span class="o">.</span><span class="n">linking_nuclei</span><span class="p">(</span><span class="n">nuclei</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>


<div class="viewcode-block" id="RateCollection.get_rates">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.get_rates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of the reaction rates in this network.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list(Rate)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span></div>


<div class="viewcode-block" id="RateCollection.get_hidden_rates">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.get_hidden_rates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_hidden_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of all of the rates approximated out of the</span>
<span class="sd">        network</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list(Rate)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hidden_rates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rates</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">ApproximateRate</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">get_child_rates</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">removed</span><span class="p">:</span>
                        <span class="n">hidden_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">ModifiedRate</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">original_rate</span><span class="o">.</span><span class="n">removed</span><span class="p">:</span>
                    <span class="n">hidden_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">original_rate</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">hidden_rates</span><span class="p">)</span></div>


<div class="viewcode-block" id="RateCollection.get_rate">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.get_rate">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rid</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a rate matching the id provided.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rid : str</span>
<span class="sd">            The id of the rate, as returned by Rate.fname</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Rate</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rid_mod</span> <span class="o">=</span> <span class="n">capitalize_rid</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">fname</span> <span class="o">==</span> <span class="n">rid_mod</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">LookupError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rate identifier </span><span class="si">{</span><span class="n">rid</span><span class="si">!r}</span><span class="s2"> does not match a rate in this network.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span></div>


<div class="viewcode-block" id="RateCollection.get_rate_by_nuclei">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.get_rate_by_nuclei">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_rate_by_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reactants</span><span class="p">,</span> <span class="n">products</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a list of reactants and products, return any matching rates</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        reactants : list(Nucleus), list(str)</span>
<span class="sd">            the reactants for the reaction.  These can either be string</span>
<span class="sd">            names or :py:class:`Nucleus &lt;pynucastro.nucdata.nucleus.Nucleus&gt;`</span>
<span class="sd">            objects.</span>
<span class="sd">        products : list(Nucleus), list(str)</span>
<span class="sd">            the products for the reaction.  These can either be string</span>
<span class="sd">            names or :py:class:`Nucleus &lt;pynucastro.nucdata.nucleus.Nucleus&gt;`</span>
<span class="sd">            objects.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rates : Rate, list(Rate)</span>
<span class="sd">            any matching rates</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reactants</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Nucleus</span><span class="o">.</span><span class="n">cast_list</span><span class="p">(</span><span class="n">reactants</span><span class="p">))</span>
        <span class="n">products</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Nucleus</span><span class="o">.</span><span class="n">cast_list</span><span class="p">(</span><span class="n">products</span><span class="p">))</span>
        <span class="n">_tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="k">if</span>
                <span class="nb">sorted</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">reactants</span><span class="p">)</span> <span class="o">==</span> <span class="n">reactants</span> <span class="ow">and</span>
                <span class="nb">sorted</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">products</span><span class="p">)</span> <span class="o">==</span> <span class="n">products</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">_tmp</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_tmp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">_tmp</span></div>


<div class="viewcode-block" id="RateCollection.get_rate_by_name">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.get_rate_by_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_rate_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a rate in the form &#39;A(x,y)B&#39; return the rate</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            the name of the rate, in the form &quot;A(x,y)B&quot;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Rate</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">reactants</span><span class="p">,</span> <span class="n">products</span> <span class="o">=</span> <span class="n">_rate_name_to_nuc</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rate_by_nuclei</span><span class="p">(</span><span class="n">reactants</span><span class="p">,</span> <span class="n">products</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">_r</span></div>


<div class="viewcode-block" id="RateCollection.get_nuclei_needing_partition_functions">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.get_nuclei_needing_partition_functions">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_nuclei_needing_partition_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of nuclei that require partition functions</span>
<span class="sd">        for one or more :py:class:`DerivedRate</span>
<span class="sd">        &lt;pynucastro.rates.derived_rate.DerivedRate&gt;` in the collection</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list(Nucleus)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nuclei_pfs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_rates</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">DerivedRate</span><span class="p">)</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">use_pf</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">reactants</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">products</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">nuc</span><span class="o">.</span><span class="n">partition_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">nuclei_pfs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">nuclei_pfs</span><span class="p">)</span></div>


<div class="viewcode-block" id="RateCollection.dedupe_partition_function_temperatures">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.dedupe_partition_function_temperatures">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">dedupe_partition_function_temperatures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of unique temperature arrays needed by</span>
<span class="sd">        partition function tables, along with a dictionary mapping</span>
<span class="sd">        each Nucleus to the corresponding index into that list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        temp_arrays : list</span>
<span class="sd">            a list of NumPy ndarray specifying the temperature values</span>
<span class="sd">            for a particular partition function tabulation.</span>
<span class="sd">        temp_indices : dict</span>
<span class="sd">            a dictionary that keyed on Nucleus that maps a nucleus to</span>
<span class="sd">            the index in temp_arrays containing the temperature array</span>
<span class="sd">            for its partition function data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nuclei</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nuclei_needing_partition_functions</span><span class="p">()</span>
        <span class="n">temp_arrays</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">temp_indices</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># nuclei must be sorted, so the output is deterministic</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">nuclei</span><span class="p">:</span>
            <span class="n">nuc_temp</span> <span class="o">=</span> <span class="n">nuc</span><span class="o">.</span><span class="n">partition_function</span><span class="o">.</span><span class="n">temperature</span>
            <span class="c1"># do a sequential search on temp_arrays, since it should be short</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">temp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">temp_arrays</span><span class="p">):</span>
                <span class="c1"># np.array_equal handles comparing arrays of different shapes</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">nuc_temp</span><span class="p">,</span> <span class="n">temp</span><span class="p">):</span>
                    <span class="n">temp_indices</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># no match found, add a new entry</span>
                <span class="n">temp_indices</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_arrays</span><span class="p">)</span>
                <span class="n">temp_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nuc_temp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">temp_arrays</span><span class="p">,</span> <span class="n">temp_indices</span></div>


<div class="viewcode-block" id="RateCollection.remove_nuclei">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.remove_nuclei">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nuc_list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;remove the nuclei in nuc_list from the network along with any rates</span>
<span class="sd">        that directly involve them (this doesn&#39;t affect approximate rates that</span>
<span class="sd">        may have these nuclei as hidden intermediate links)&quot;&quot;&quot;</span>

        <span class="n">nuc_list</span> <span class="o">=</span> <span class="n">Nucleus</span><span class="o">.</span><span class="n">cast_list</span><span class="p">(</span><span class="n">nuc_list</span><span class="p">)</span>
        <span class="n">rates_to_delete</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">nuc_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">rate</span><span class="o">.</span><span class="n">reactants</span> <span class="o">+</span> <span class="n">rate</span><span class="o">.</span><span class="n">products</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;looking to remove </span><span class="si">{</span><span class="n">rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">rates_to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">rate</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">rates_to_delete</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_build_collection</span><span class="p">()</span></div>


<div class="viewcode-block" id="RateCollection.remove_rates">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.remove_rates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rates</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;remove the Rate objects in rates from the network.  Note, if</span>
<span class="sd">        rate list is a dict, then the keys are assumed to be the rates</span>
<span class="sd">        to remove&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rates</span><span class="p">,</span> <span class="n">Rate</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">rates</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rates</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_build_collection</span><span class="p">()</span></div>


<div class="viewcode-block" id="RateCollection.add_rates">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.add_rates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rates</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add new rates to the network.  If the rate already exists,</span>
<span class="sd">        it will not be added.  The network is then regenerated using</span>
<span class="sd">        the updated rates</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rates : Rate, list(Rate)</span>
<span class="sd">             a single Rate object or a list of Rate objects specifying the</span>
<span class="sd">             rates to be added to the network.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rates</span><span class="p">,</span> <span class="n">Rate</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">rates</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rates</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rates</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">r</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_build_collection</span><span class="p">()</span></div>


<div class="viewcode-block" id="RateCollection.make_ap_pg_approx">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.make_ap_pg_approx">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_ap_pg_approx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intermediate_nuclei</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Combine the rates A(a,g)B and A(a,p)X(p,g)B (and the</span>
<span class="sd">        reverse) into a single effective approximate rate.  The new</span>
<span class="sd">        approximate rates will be added to the network and the original</span>
<span class="sd">        rates will be removed (although they are still carried by the</span>
<span class="sd">        ApproximateRate object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        intermediate_nuclei : list, tuple</span>
<span class="sd">            an iterable of Nucleus objects or string names representing</span>
<span class="sd">            the intermediate nucleus we wish to approximate out.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># make sure that the intermediate_nuclei list are Nuclei objects</span>
        <span class="n">intermediate_nuclei</span> <span class="o">=</span> <span class="n">Nucleus</span><span class="o">.</span><span class="n">cast_list</span><span class="p">(</span><span class="n">intermediate_nuclei</span><span class="p">,</span> <span class="n">allow_None</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># find all of the (a,g) rates</span>
        <span class="n">ag_rates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">reactants</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;he4&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">reactants</span> <span class="ow">and</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">products</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ag_rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

        <span class="c1"># for each (a,g), check to see if the remaining rates are present</span>
        <span class="n">approx_rates</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">r_ag</span> <span class="ow">in</span> <span class="n">ag_rates</span><span class="p">:</span>
            <span class="n">prim_nuc</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">r_ag</span><span class="o">.</span><span class="n">reactants</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">prim_prod</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">r_ag</span><span class="o">.</span><span class="n">products</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">inter_nuc</span> <span class="o">=</span> <span class="n">Nucleus</span><span class="o">.</span><span class="n">from_Z_A</span><span class="p">(</span><span class="n">prim_nuc</span><span class="o">.</span><span class="n">Z</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">prim_nuc</span><span class="o">.</span><span class="n">A</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">intermediate_nuclei</span> <span class="ow">and</span> <span class="n">inter_nuc</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">intermediate_nuclei</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># look for A(a,p)X</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">r_ap</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rate_by_nuclei</span><span class="p">([</span><span class="n">prim_nuc</span><span class="p">,</span> <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;he4&quot;</span><span class="p">)],</span>
                                                    <span class="p">[</span><span class="n">inter_nuc</span><span class="p">,</span> <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)])):</span>
                <span class="k">continue</span>

            <span class="c1"># look for X(p,g)B</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">r_pg</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rate_by_nuclei</span><span class="p">([</span><span class="n">inter_nuc</span><span class="p">,</span> <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)],</span>
                                                    <span class="p">[</span><span class="n">prim_prod</span><span class="p">])):</span>
                <span class="k">continue</span>

            <span class="c1"># look for reverse B(g,a)A</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">r_ga</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rate_by_nuclei</span><span class="p">([</span><span class="n">prim_prod</span><span class="p">],</span>
                                                    <span class="p">[</span><span class="n">prim_nuc</span><span class="p">,</span> <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;he4&quot;</span><span class="p">)])):</span>
                <span class="k">continue</span>

            <span class="c1"># look for reverse B(g,p)X</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">r_gp</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rate_by_nuclei</span><span class="p">([</span><span class="n">prim_prod</span><span class="p">],</span>
                                                    <span class="p">[</span><span class="n">inter_nuc</span><span class="p">,</span> <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)])):</span>
                <span class="k">continue</span>

            <span class="c1"># look for reverse X(p,a)A</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">r_pa</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rate_by_nuclei</span><span class="p">([</span><span class="n">inter_nuc</span><span class="p">,</span> <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)],</span>
                                                    <span class="p">[</span><span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;he4&quot;</span><span class="p">),</span> <span class="n">prim_nuc</span><span class="p">])):</span>
                <span class="k">continue</span>

            <span class="c1"># build the approximate rates</span>
            <span class="n">ar</span> <span class="o">=</span> <span class="n">ApproximateRate</span><span class="p">(</span><span class="n">r_ag</span><span class="p">,</span> <span class="p">[</span><span class="n">r_ap</span><span class="p">,</span> <span class="n">r_pg</span><span class="p">],</span> <span class="n">r_ga</span><span class="p">,</span> <span class="p">[</span><span class="n">r_gp</span><span class="p">,</span> <span class="n">r_pa</span><span class="p">],</span> <span class="n">approx_type</span><span class="o">=</span><span class="s2">&quot;ap_pg&quot;</span><span class="p">)</span>
            <span class="n">ar_reverse</span> <span class="o">=</span> <span class="n">ApproximateRate</span><span class="p">(</span><span class="n">r_ag</span><span class="p">,</span> <span class="p">[</span><span class="n">r_ap</span><span class="p">,</span> <span class="n">r_pg</span><span class="p">],</span> <span class="n">r_ga</span><span class="p">,</span> <span class="p">[</span><span class="n">r_gp</span><span class="p">,</span> <span class="n">r_pa</span><span class="p">],</span> <span class="n">is_reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">approx_type</span><span class="o">=</span><span class="s2">&quot;ap_pg&quot;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using approximate rate </span><span class="si">{</span><span class="n">ar</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using approximate rate </span><span class="si">{</span><span class="n">ar_reverse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># approximate rates</span>
            <span class="n">approx_rates</span> <span class="o">+=</span> <span class="p">[</span><span class="n">ar</span><span class="p">,</span> <span class="n">ar_reverse</span><span class="p">]</span>

        <span class="c1"># remove the old rates from the rate list and add the approximate rate</span>
        <span class="k">for</span> <span class="n">ar</span> <span class="ow">in</span> <span class="n">approx_rates</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ar</span><span class="o">.</span><span class="n">get_child_rates</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;removing rate </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="c1"># add the approximate rates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>

        <span class="c1"># regenerate the links</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_collection</span><span class="p">()</span></div>


<div class="viewcode-block" id="RateCollection.make_nn_g_approx">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.make_nn_g_approx">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_nn_g_approx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intermediate_nuclei</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Combine the rates A(n,g)X(n,g)B into a single effective</span>
<span class="sd">        rate. The new approximate rates will be added to the network</span>
<span class="sd">        and the original rates will be removed (although they are</span>
<span class="sd">        still carried by the ApproximateRate object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        intermediate_nuclei : list, tuple</span>
<span class="sd">            an iterable of `Nucleus &lt;pynucastro.nucdata.nucleus.Nucleus&gt;`</span>
<span class="sd">            or string names representing the intermediate nucleus we</span>
<span class="sd">            wish to approximate out.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># make sure that the intermediate_nuclei list are Nuclei objects</span>
        <span class="n">intermediate_nuclei</span> <span class="o">=</span> <span class="n">Nucleus</span><span class="o">.</span><span class="n">cast_list</span><span class="p">(</span><span class="n">intermediate_nuclei</span><span class="p">,</span> <span class="n">allow_None</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># if we didn&#39;t pass in a list of nuclei, consider all as targets</span>
        <span class="c1"># for approximation</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">intermediate_nuclei</span><span class="p">:</span>
            <span class="n">intermediate_nuclei</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span>

        <span class="c1"># for each intermediate nuclei X, look to see if we have A(n,g)X and X(n,g)B</span>
        <span class="n">approx_rates</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nuclei_approximated_out</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">inter_nuc</span> <span class="ow">in</span> <span class="n">intermediate_nuclei</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">inter_nuc</span><span class="o">.</span><span class="n">A</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># can&#39;t approximate out protons or neutrons</span>
                <span class="k">continue</span>

            <span class="n">nuc_A</span> <span class="o">=</span> <span class="n">inter_nuc</span> <span class="o">-</span> <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">)</span>
            <span class="n">nuc_B</span> <span class="o">=</span> <span class="n">inter_nuc</span> <span class="o">+</span> <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">nuc_A</span> <span class="ow">in</span> <span class="n">nuclei_approximated_out</span><span class="p">:</span>
                <span class="c1"># don&#39;t try to approximate a rate sequence starting with</span>
                <span class="c1"># a nucleus that we already approximated out</span>
                <span class="k">continue</span>

            <span class="c1"># look for A(n,g)X</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">rf1</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rate_by_nuclei</span><span class="p">([</span><span class="n">nuc_A</span><span class="p">,</span> <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">)],</span>
                                                   <span class="p">[</span><span class="n">inter_nuc</span><span class="p">])):</span>
                <span class="k">continue</span>

            <span class="c1"># look for X(n,g)B</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">rf2</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rate_by_nuclei</span><span class="p">([</span><span class="n">inter_nuc</span><span class="p">,</span> <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">)],</span>
                                                   <span class="p">[</span><span class="n">nuc_B</span><span class="p">])):</span>
                <span class="k">continue</span>

            <span class="c1"># look for reverse B(g,n)X</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">rr1</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rate_by_nuclei</span><span class="p">([</span><span class="n">nuc_B</span><span class="p">],</span>
                                                   <span class="p">[</span><span class="n">inter_nuc</span><span class="p">,</span> <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">)])):</span>
                <span class="k">continue</span>

            <span class="c1"># look for reverse X(g,n)A</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">rr2</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rate_by_nuclei</span><span class="p">([</span><span class="n">inter_nuc</span><span class="p">],</span>
                                                   <span class="p">[</span><span class="n">nuc_A</span><span class="p">,</span> <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">)])):</span>
                <span class="k">continue</span>

            <span class="c1"># build the approximate rates</span>
            <span class="n">ar</span> <span class="o">=</span> <span class="n">ApproximateRate</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">rf1</span><span class="p">,</span> <span class="n">rf2</span><span class="p">],</span>
                                 <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">rr1</span><span class="p">,</span> <span class="n">rr2</span><span class="p">],</span>
                                 <span class="n">approx_type</span><span class="o">=</span><span class="s2">&quot;nn_g&quot;</span><span class="p">,</span>
                                 <span class="n">use_identical_particle_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">ar_reverse</span> <span class="o">=</span> <span class="n">ApproximateRate</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">rf1</span><span class="p">,</span> <span class="n">rf2</span><span class="p">],</span>
                                         <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">rr1</span><span class="p">,</span> <span class="n">rr2</span><span class="p">],</span>
                                         <span class="n">is_reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">approx_type</span><span class="o">=</span><span class="s2">&quot;nn_g&quot;</span><span class="p">,</span>
                                         <span class="n">use_identical_particle_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">nuclei_approximated_out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inter_nuc</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;approximating out </span><span class="si">{</span><span class="n">inter_nuc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using approximate rate </span><span class="si">{</span><span class="n">ar</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;using approximate rate </span><span class="si">{</span><span class="n">ar_reverse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># approximate rates</span>
            <span class="n">approx_rates</span> <span class="o">+=</span> <span class="p">[</span><span class="n">ar</span><span class="p">,</span> <span class="n">ar_reverse</span><span class="p">]</span>

        <span class="c1"># remove the old rates from the rate list and add the approximate rate</span>
        <span class="k">for</span> <span class="n">ar</span> <span class="ow">in</span> <span class="n">approx_rates</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">ar</span><span class="o">.</span><span class="n">get_child_rates</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;removing rate </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="c1"># add the approximate rates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>

        <span class="c1"># regenerate the links</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_collection</span><span class="p">()</span></div>


<div class="viewcode-block" id="RateCollection.make_nse_protons">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.make_nse_protons">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">make_nse_protons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;for rates involving nuclei with mass number &gt;= A, swap any</span>
<span class="sd">        protons for NSE protons.  This will decouple these rates from</span>
<span class="sd">        the proton captures at lower mass number, simplifying the</span>
<span class="sd">        linear algebra.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        A : int</span>
<span class="sd">            mass number above which to swap regular protons for</span>
<span class="sd">            NSE protons.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># we want to update both the forward and reverse rates,</span>
        <span class="c1"># so we are consistent</span>
        <span class="k">for</span> <span class="n">rp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rate_pairs</span><span class="p">():</span>

            <span class="n">update</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">rp</span><span class="o">.</span><span class="n">forward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">heavy</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">rp</span><span class="o">.</span><span class="n">forward</span><span class="o">.</span><span class="n">reactants</span> <span class="o">+</span> <span class="n">rp</span><span class="o">.</span><span class="n">forward</span><span class="o">.</span><span class="n">products</span>
                         <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">),</span> <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">),</span> <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;he4&quot;</span><span class="p">)]]</span>
                <span class="k">if</span> <span class="n">heavy</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">heavy</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">A</span> <span class="o">&gt;=</span> <span class="n">A</span> <span class="ow">and</span>
                        <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rp</span><span class="o">.</span><span class="n">forward</span><span class="o">.</span><span class="n">reactants</span> <span class="o">+</span> <span class="n">rp</span><span class="o">.</span><span class="n">forward</span><span class="o">.</span><span class="n">products</span><span class="p">):</span>
                        <span class="n">update</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">rp</span><span class="o">.</span><span class="n">reverse</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">heavy</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">rp</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">reactants</span> <span class="o">+</span> <span class="n">rp</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">products</span>
                         <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">),</span> <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">),</span> <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;he4&quot;</span><span class="p">)]]</span>
                <span class="k">if</span> <span class="n">heavy</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">heavy</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">A</span> <span class="o">&gt;=</span> <span class="n">A</span> <span class="ow">and</span>
                        <span class="n">Nucleus</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rp</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">reactants</span> <span class="o">+</span> <span class="n">rp</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">products</span><span class="p">):</span>
                        <span class="n">update</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">update</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rp</span><span class="o">.</span><span class="n">forward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;modifying </span><span class="si">{</span><span class="n">rp</span><span class="o">.</span><span class="n">forward</span><span class="o">.</span><span class="n">fname</span><span class="si">}</span><span class="s2"> to use NSE protons&quot;</span><span class="p">)</span>
                    <span class="n">rp</span><span class="o">.</span><span class="n">forward</span><span class="o">.</span><span class="n">swap_protons</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">rp</span><span class="o">.</span><span class="n">reverse</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;modifying </span><span class="si">{</span><span class="n">rp</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">fname</span><span class="si">}</span><span class="s2"> to use NSE protons&quot;</span><span class="p">)</span>
                    <span class="n">rp</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">swap_protons</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_build_collection</span><span class="p">()</span></div>


<div class="viewcode-block" id="RateCollection.summary">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.summary">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print a summary of the nuclei and rates for this network&quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Network summary&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---------------&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  explicitly carried nuclei: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  approximated-out nuclei: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">approx_nuclei</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inert_nuclei</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  inert nuclei (included in carried): </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inert_nuclei</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  inert nuclei (included in carried): 0&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  total number of rates: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_rates</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  rates explicitly connecting nuclei: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  hidden rates: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_hidden_rates</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  reaclib rates: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reaclib_rates</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  tabular rates: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabular_rates</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  approximate rates: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">approx_rates</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  derived rates: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">derived_rates</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  modified rates: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modified_rates</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  custom rates: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_rates</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="RateCollection.evaluate_rates">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.evaluate_rates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">composition</span><span class="p">,</span> <span class="n">screen_func</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;evaluate the rates for a specific density, temperature, and</span>
<span class="sd">        composition, with optional screening.  Note: this returns that</span>
<span class="sd">        rate as dY/dt, where Y is the molar fraction.  For a 2 body</span>
<span class="sd">        reaction, a + b, this will be of the form:</span>

<span class="sd">        ρ Y_a Y_b N_A &lt;σv&gt; / (1 + δ_{ab})</span>

<span class="sd">        where δ is the Kronecker delta that accounts for a = b.</span>

<span class="sd">        If you want dn/dt, where n is the number density (so you get</span>
<span class="sd">        n_a n_b &lt;σv&gt;), then you need to multiply the results here</span>
<span class="sd">        by ρ N_A (where N_A is Avogadro&#39;s number).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rho : float</span>
<span class="sd">            density used to evaluate rates</span>
<span class="sd">        T : float</span>
<span class="sd">            temperature used to evaluate rates</span>
<span class="sd">        composition : Composition</span>
<span class="sd">            composition used to evaluate rates</span>
<span class="sd">        screen_func : Callable</span>
<span class="sd">            one of the screening functions from :py:mod:`pynucastro.screening`</span>
<span class="sd">            -- if provided, then the evaluated rates will include the screening</span>
<span class="sd">            correction.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict(Rate)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rvals</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="n">composition</span><span class="o">.</span><span class="n">get_molar</span><span class="p">()</span>
        <span class="n">y_e</span> <span class="o">=</span> <span class="n">composition</span><span class="o">.</span><span class="n">ye</span>

        <span class="k">if</span> <span class="n">screen_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">screen_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_screening</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">composition</span><span class="p">,</span> <span class="n">screen_func</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">screen_factors</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">prefactor</span> <span class="o">*</span> <span class="n">rho</span><span class="o">**</span><span class="n">r</span><span class="o">.</span><span class="n">dens_exp</span> <span class="o">*</span> <span class="n">r</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="n">composition</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">weak_type</span> <span class="o">==</span> <span class="s1">&#39;electron_capture&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">TabularRate</span><span class="p">)):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">*</span> <span class="n">y_e</span>
            <span class="n">yfac</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">mul</span><span class="p">,</span> <span class="p">[</span><span class="n">ys</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">reactants</span><span class="p">])</span>
            <span class="n">rvals</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="n">yfac</span> <span class="o">*</span> <span class="n">val</span> <span class="o">*</span> <span class="n">screen_factors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rvals</span></div>


<div class="viewcode-block" id="RateCollection.evaluate_jacobian">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.evaluate_jacobian">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate_jacobian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                          <span class="n">screen_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude_rates</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return an array of the form J_ij = dYdot_i/dY_j for the network</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rho : float</span>
<span class="sd">            density used to evaluate Jacobian terms</span>
<span class="sd">        T : float</span>
<span class="sd">            temperature used to evaluate Jacobian terms</span>
<span class="sd">        comp : Composition</span>
<span class="sd">            composition used to evaluate Jacobian terms</span>
<span class="sd">        screen_func : Callable</span>
<span class="sd">            one of the screening functions from :py:mod:`pynucastro.screening`</span>
<span class="sd">            -- if provided, then the evaluated rates will include the screening</span>
<span class="sd">            correction.</span>
<span class="sd">        exclude_rates : Iterable(Rate)</span>
<span class="sd">            a list of rates to omit from the construction of the Jacobian.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy.ndarray</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># the rate.eval_jacobian_term does not compute the screening,</span>
        <span class="c1"># so we multiply by the factors afterwards</span>
        <span class="k">if</span> <span class="n">screen_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">screen_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_screening</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">screen_func</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">screen_factors</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">exclude_rates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exclude_rates</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">nnuc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">)</span>
        <span class="n">jac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nnuc</span><span class="p">,</span> <span class="n">nnuc</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">n_j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">):</span>

                <span class="c1"># we are considering dYdot(n_i) / dY(n_j)</span>

                <span class="n">jac</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_consumed</span><span class="p">[</span><span class="n">n_i</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">exclude_rates</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="c1"># how many of n_i are destroyed by this reaction</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">reactant_count</span><span class="p">(</span><span class="n">n_i</span><span class="p">)</span>
                    <span class="n">jac</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">screen_factors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span>\
                        <span class="n">r</span><span class="o">.</span><span class="n">eval_jacobian_term</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">n_j</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_produced</span><span class="p">[</span><span class="n">n_i</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">exclude_rates</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="c1"># how many of n_i are produced by this reaction</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">product_count</span><span class="p">(</span><span class="n">n_i</span><span class="p">)</span>
                    <span class="n">jac</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">screen_factors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span>\
                        <span class="n">r</span><span class="o">.</span><span class="n">eval_jacobian_term</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">n_j</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jac</span></div>


<div class="viewcode-block" id="RateCollection.spectral_radius">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.spectral_radius">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">spectral_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                        <span class="n">screen_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude_rates</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the spectral radius of the Jacobian---this is the</span>
<span class="sd">        max{abs(e_i)}, where e_i are the eigenvalues of the Jacobian.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rho : float</span>
<span class="sd">            density used to evaluate Jacobian terms</span>
<span class="sd">        T : float</span>
<span class="sd">            temperature used to evaluate Jacobian terms</span>
<span class="sd">        comp : Composition</span>
<span class="sd">            composition used to evaluate Jacobian terms</span>
<span class="sd">        screen_func : Callable</span>
<span class="sd">            one of the screening functions from :py:mod:`pynucastro.screening`</span>
<span class="sd">            -- if provided, then the evaluated rates will include the screening</span>
<span class="sd">            correction.</span>
<span class="sd">        exclude_rates : Iterable(Rate)</span>
<span class="sd">            a list of rates to omit from the calculation.  This is useful</span>
<span class="sd">            for testing how the spectral radius / stiffness is affected by</span>
<span class="sd">            the different rates.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">J</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_jacobian</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span>
                                   <span class="n">screen_func</span><span class="o">=</span><span class="n">screen_func</span><span class="p">,</span>
                                   <span class="n">exclude_rates</span><span class="o">=</span><span class="n">exclude_rates</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">eigvals</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="RateCollection.validate">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.validate">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_library</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">forward_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform various checks on the library, comparing to</span>
<span class="sd">        ``other_library``, to ensure that we are not missing important</span>
<span class="sd">        rates.  The idea is that the current library should be a</span>
<span class="sd">        reduced library (perhaps the result of filtering) and then we</span>
<span class="sd">        want to compare to the larger ``other_library`` to see if we</span>
<span class="sd">        missed something important.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other_library : Library</span>
<span class="sd">            the library to compare to</span>
<span class="sd">        forward_only : bool</span>
<span class="sd">            do we only check the forward rates?</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">current_rates</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_rates</span><span class="p">())</span>

        <span class="c1"># check the forward rates to see if any of the products are</span>
        <span class="c1"># not consumed by other forward rates</span>

        <span class="n">passed_validation</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">rate</span> <span class="ow">in</span> <span class="n">current_rates</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rate</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">rate</span><span class="o">.</span><span class="n">products</span><span class="p">:</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">orate</span> <span class="ow">in</span> <span class="n">current_rates</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">orate</span> <span class="o">==</span> <span class="n">rate</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">orate</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">orate</span><span class="o">.</span><span class="n">reactants</span><span class="p">:</span>
                        <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                    <span class="n">passed_validation</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;validation: </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2"> produced in </span><span class="si">{</span><span class="n">rate</span><span class="si">}</span><span class="s2"> never consumed.&quot;</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># now check if we are missing any rates from other_library with the exact same reactants</span>

        <span class="n">other_by_reactants</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rate</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">other_library</span><span class="o">.</span><span class="n">get_rates</span><span class="p">()):</span>
            <span class="n">other_by_reactants</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">rate</span><span class="o">.</span><span class="n">reactants</span><span class="p">))]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">rate</span> <span class="ow">in</span> <span class="n">current_rates</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">forward_only</span> <span class="ow">and</span> <span class="n">rate</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">key</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">rate</span><span class="o">.</span><span class="n">reactants</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">other_rate</span> <span class="ow">in</span> <span class="n">other_by_reactants</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                <span class="c1"># check to see if other_rate is already in current_rates</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">other_rate</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_rates</span><span class="p">:</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;validation: missing </span><span class="si">{</span><span class="n">other_rate</span><span class="si">}</span><span class="s2"> as alternative to </span><span class="si">{</span><span class="n">rate</span><span class="si">}</span><span class="s2"> (Q = </span><span class="si">{</span><span class="n">other_rate</span><span class="o">.</span><span class="n">Q</span><span class="si">}</span><span class="s2"> MeV).&quot;</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">passed_validation</span></div>


<div class="viewcode-block" id="RateCollection.find_duplicate_links">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.find_duplicate_links">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_duplicate_links</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the network to see if there are multiple rates that</span>
<span class="sd">        share the same reactants and products.  These may not be the</span>
<span class="sd">        same Rate object (e.g., one could be tabular the other a</span>
<span class="sd">        simple decay), but they will present themselves in the network</span>
<span class="sd">        as the same link.</span>

<span class="sd">        We return a list, where each entry is a list of all the rates</span>
<span class="sd">        that share the same link.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">duplicates</span> <span class="o">=</span> <span class="n">find_duplicate_rates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_rates</span><span class="p">())</span>

        <span class="c1"># there are some allowed duplicates for special cases.  We</span>
        <span class="c1"># will now check for those</span>
        <span class="n">dupe_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dupe</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_allowed_dupe</span><span class="p">(</span><span class="n">dupe</span><span class="p">):</span>
                <span class="n">dupe_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dupe</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">dupe</span> <span class="ow">in</span> <span class="n">dupe_to_remove</span><span class="p">:</span>
            <span class="n">duplicates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dupe</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">duplicates</span></div>


<div class="viewcode-block" id="RateCollection.find_unimportant_rates">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.find_unimportant_rates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_unimportant_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">states</span><span class="p">,</span> <span class="n">cutoff_ratio</span><span class="p">,</span> <span class="n">screen_func</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate the rates at multiple thermodynamic states, and</span>
<span class="sd">        find the rates that are always less than `cutoff_ratio` times</span>
<span class="sd">        the fastest rate for each state.  This returns a dict keyed by</span>
<span class="sd">        Rate giving the ratio of the rate to the largest rate.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        states : list, tuple</span>
<span class="sd">             A tuple of the form (density, temperature, composition),</span>
<span class="sd">             where composition is a Composition object</span>
<span class="sd">        cutoff_ratio : float</span>
<span class="sd">             The ratio of a rate to the fastest rate, below which we</span>
<span class="sd">             consider this rate to be unimportant.</span>
<span class="sd">        screen_func : Callable</span>
<span class="sd">            one of the screening functions from :py:mod:`pynucastro.screening`</span>
<span class="sd">            -- if provided, then the evaluated rates will include the screening</span>
<span class="sd">            correction.</span>

<span class="sd">        Return</span>
<span class="sd">        ------</span>
<span class="sd">        dict(Rate)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">largest_ratio</span> <span class="o">=</span> <span class="p">{</span><span class="n">r</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
            <span class="n">rvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_rates</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">screen_func</span><span class="p">)</span>
            <span class="n">fastest</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">rvals</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">rvals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">largest_ratio</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">largest_ratio</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">value</span> <span class="o">/</span> <span class="n">fastest</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">r</span><span class="p">:</span> <span class="n">ratio</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">ratio</span> <span class="ow">in</span> <span class="n">largest_ratio</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">ratio</span> <span class="o">&lt;</span> <span class="n">cutoff_ratio</span><span class="p">}</span></div>


<div class="viewcode-block" id="RateCollection.evaluate_screening">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.evaluate_screening">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate_screening</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">composition</span><span class="p">,</span> <span class="n">screen_func</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate the screening factors for each rate.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rho : float</span>
<span class="sd">            density used to evaluate screening</span>
<span class="sd">        T : float</span>
<span class="sd">            temperature used to evaluate screening</span>
<span class="sd">        composition : Composition</span>
<span class="sd">            composition used to evaluate screening</span>
<span class="sd">        screen_func : Callable</span>
<span class="sd">            one of the screening functions from :py:mod:`pynucastro.screening`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict(Rate)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># this follows the same logic as BaseCxxNetwork._compute_screening_factors()</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="n">composition</span><span class="o">.</span><span class="n">get_molar</span><span class="p">()</span>
        <span class="n">plasma_state</span> <span class="o">=</span> <span class="n">make_plasma_state</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_screening</span><span class="p">:</span>
            <span class="n">screening_map</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">screening_map</span> <span class="o">=</span> <span class="n">get_screening_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_rates</span><span class="p">(),</span>
                                              <span class="n">symmetric_screening</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetric_screening</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">scr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">screening_map</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">scr</span><span class="o">.</span><span class="n">n1</span><span class="o">.</span><span class="n">dummy</span> <span class="ow">or</span> <span class="n">scr</span><span class="o">.</span><span class="n">n2</span><span class="o">.</span><span class="n">dummy</span><span class="p">):</span>
                <span class="n">scn_fac</span> <span class="o">=</span> <span class="n">make_screen_factors</span><span class="p">(</span><span class="n">scr</span><span class="o">.</span><span class="n">n1</span><span class="p">,</span> <span class="n">scr</span><span class="o">.</span><span class="n">n2</span><span class="p">)</span>
                <span class="n">scor</span> <span class="o">=</span> <span class="n">screen_func</span><span class="p">(</span><span class="n">plasma_state</span><span class="p">,</span> <span class="n">scn_fac</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">scr</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;He4_He4_He4&quot;</span><span class="p">:</span>
                <span class="c1"># we don&#39;t need to do anything here, but we want to avoid</span>
                <span class="c1"># immediately applying the screening</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">scr</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;He4_He4_He4_dummy&quot;</span><span class="p">:</span>
                <span class="c1"># make sure the previous iteration was the first part of 3-alpha</span>
                <span class="k">assert</span> <span class="n">screening_map</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;He4_He4_He4&quot;</span>
                <span class="c1"># handle the second part of the screening for 3-alpha</span>
                <span class="n">scn_fac2</span> <span class="o">=</span> <span class="n">make_screen_factors</span><span class="p">(</span><span class="n">scr</span><span class="o">.</span><span class="n">n1</span><span class="p">,</span> <span class="n">scr</span><span class="o">.</span><span class="n">n2</span><span class="p">)</span>
                <span class="n">scor2</span> <span class="o">=</span> <span class="n">screen_func</span><span class="p">(</span><span class="n">plasma_state</span><span class="p">,</span> <span class="n">scn_fac2</span><span class="p">)</span>

                <span class="c1"># there might be both the forward and reverse 3-alpha</span>
                <span class="c1"># if we are doing symmetric screening</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">scr</span><span class="o">.</span><span class="n">rates</span><span class="p">:</span>
                    <span class="c1"># use scor from the previous loop iteration</span>
                    <span class="c1"># pylint: disable-next=possibly-used-before-assignment</span>
                    <span class="n">factors</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="n">scor</span> <span class="o">*</span> <span class="n">scor2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># there might be several rates that have the same</span>
                <span class="c1"># reactants and therefore the same screening applies</span>
                <span class="c1"># -- handle them all now</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">scr</span><span class="o">.</span><span class="n">rates</span><span class="p">:</span>
                    <span class="n">factors</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="n">scor</span>

        <span class="k">return</span> <span class="n">factors</span></div>


<div class="viewcode-block" id="RateCollection.evaluate_ydots">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.evaluate_ydots">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate_ydots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">composition</span><span class="p">,</span>
                       <span class="n">screen_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rate_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate net rate of change of molar abundance for each</span>
<span class="sd">        nucleus for a specific density, temperature, and composition</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rho : float</span>
<span class="sd">            density used to evaluate rates</span>
<span class="sd">        T : float</span>
<span class="sd">            temperature used to evaluate rates</span>
<span class="sd">        composition : Composition</span>
<span class="sd">            composition used to evaluate rates</span>
<span class="sd">        screen_func : Callable</span>
<span class="sd">            a function from :py:mod:`pynucastro.screening` used to compute the</span>
<span class="sd">            screening enhancement for the rates.</span>
<span class="sd">        rate_filter : Callable</span>
<span class="sd">            a function that takes a :py:class:`Rate &lt;pynucastro.rates.rate.Rate&gt;`</span>
<span class="sd">            and returns `True` or `False` if it is to be evaluated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict(Nucleus)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_rates</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">composition</span><span class="p">,</span> <span class="n">screen_func</span><span class="p">)</span>
        <span class="n">ydots</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">:</span>

            <span class="c1"># Rates that consume / produce nuc</span>
            <span class="k">if</span> <span class="n">rate_filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">consuming_rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_consumed</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span>
                <span class="n">producing_rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_produced</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">consuming_rates</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_consumed</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span> <span class="k">if</span> <span class="n">rate_filter</span><span class="p">(</span><span class="n">r</span><span class="p">)]</span>
                <span class="n">producing_rates</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_produced</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span> <span class="k">if</span> <span class="n">rate_filter</span><span class="p">(</span><span class="n">r</span><span class="p">)]</span>

            <span class="c1"># Number of nuclei consumed / produced</span>
            <span class="n">nconsumed</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">reactant_count</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">consuming_rates</span><span class="p">)</span>
            <span class="n">nproduced</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">product_count</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">producing_rates</span><span class="p">)</span>

            <span class="c1"># Multiply each rate by the count</span>
            <span class="n">consumed</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">rvals</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nconsumed</span><span class="p">,</span> <span class="n">consuming_rates</span><span class="p">))</span>
            <span class="n">produced</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">rvals</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nproduced</span><span class="p">,</span> <span class="n">producing_rates</span><span class="p">))</span>

            <span class="c1"># Net change is difference between produced and consumed</span>
            <span class="n">ydots</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">produced</span><span class="p">)</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">consumed</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ydots</span></div>


<div class="viewcode-block" id="RateCollection.evaluate_energy_generation">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.evaluate_energy_generation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate_energy_generation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">composition</span><span class="p">,</span>
                                   <span class="n">screen_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_enu</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate the specific energy generation rate of the network for a specific</span>
<span class="sd">        density, temperature and composition</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rho : float</span>
<span class="sd">            density to evaluate the rates with</span>
<span class="sd">        T : float</span>
<span class="sd">            temperature to evaluate the rates with</span>
<span class="sd">        composition : Composition</span>
<span class="sd">            composition to evaluate the rates with</span>
<span class="sd">        screen_func : Callable</span>
<span class="sd">            a function from :py:mod:`pynucastro.screening` to</span>
<span class="sd">            call to compute the screening factor</span>
<span class="sd">        return_enu : bool</span>
<span class="sd">            return both enuc and enu -- the energy loss</span>
<span class="sd">            from neutrinos from weak reactions</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        enuc : float</span>
<span class="sd">            the energy generation rate</span>
<span class="sd">        enu : float</span>
<span class="sd">            the neutrino loss rate from weak reactions</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ydots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_ydots</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">composition</span><span class="p">,</span> <span class="n">screen_func</span><span class="p">)</span>
        <span class="n">enuc</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="c1"># compute constants and units</span>

        <span class="c1"># ion binding energy contributions. basically e=mc^2</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">:</span>
            <span class="n">enuc</span> <span class="o">+=</span> <span class="n">ydots</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span> <span class="o">*</span> <span class="n">nuc</span><span class="o">.</span><span class="n">mass</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">MeV2erg</span>

        <span class="c1"># convert from molar value to erg/g/s</span>
        <span class="n">enuc</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">constants</span><span class="o">.</span><span class="n">N_A</span>

        <span class="c1"># subtract neutrino losses for tabular weak reactions</span>
        <span class="n">enu</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">TabularRate</span><span class="p">):</span>
                <span class="c1"># get composition</span>
                <span class="n">ys</span> <span class="o">=</span> <span class="n">composition</span><span class="o">.</span><span class="n">get_molar</span><span class="p">()</span>

                <span class="c1"># need to get reactant nucleus</span>
                <span class="n">nuc</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">reactants</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">enu</span> <span class="o">+=</span> <span class="n">constants</span><span class="o">.</span><span class="n">N_A</span> <span class="o">*</span> <span class="n">ys</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span> <span class="o">*</span> <span class="n">r</span><span class="o">.</span><span class="n">get_nu_loss</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="n">composition</span><span class="p">)</span>

        <span class="n">enuc</span> <span class="o">-=</span> <span class="n">enu</span>
        <span class="k">if</span> <span class="n">return_enu</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">enuc</span><span class="p">,</span> <span class="n">enu</span>
        <span class="k">return</span> <span class="n">enuc</span></div>


<div class="viewcode-block" id="RateCollection.evaluate_activity">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.evaluate_activity">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">composition</span><span class="p">,</span> <span class="n">screen_func</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the activity for each nucleus--the sum of</span>
<span class="sd">        abs(creation rate) + abs(destruction rate), i.e., this neglects the</span>
<span class="sd">        sign of the terms.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rho : float</span>
<span class="sd">            density used to evaluate rates</span>
<span class="sd">        T : float</span>
<span class="sd">            temperature used to evaluate rates</span>
<span class="sd">        composition : Composition</span>
<span class="sd">            composition used to evaluate rates</span>
<span class="sd">        screen_func : Callable</span>
<span class="sd">            one of the screening functions from :py:mod:`pynucastro.screening`</span>
<span class="sd">            -- if provided, then the evaluated rates will include the screening</span>
<span class="sd">            correction.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict(Nucleus)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_rates</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">composition</span><span class="p">,</span> <span class="n">screen_func</span><span class="p">)</span>
        <span class="n">act</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">:</span>

            <span class="c1"># Rates that consume / produce nuc</span>
            <span class="n">consuming_rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_consumed</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span>
            <span class="n">producing_rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_produced</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span>
            <span class="c1"># Number of nuclei consumed / produced</span>
            <span class="n">nconsumed</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">reactant_count</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">consuming_rates</span><span class="p">)</span>
            <span class="n">nproduced</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">product_count</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">producing_rates</span><span class="p">)</span>
            <span class="c1"># Multiply each rate by the count</span>
            <span class="n">consumed</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">rvals</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nconsumed</span><span class="p">,</span> <span class="n">consuming_rates</span><span class="p">))</span>
            <span class="n">produced</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">rvals</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nproduced</span><span class="p">,</span> <span class="n">producing_rates</span><span class="p">))</span>
            <span class="c1"># Net activity is sum of produced and consumed</span>
            <span class="n">act</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">produced</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">consumed</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">act</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_get_network_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">composition</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;a network chart is a dict, keyed by rate that holds a list</span>
<span class="sd">        of tuples (Nucleus, ydot)&quot;&quot;&quot;</span>

        <span class="n">rvals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_rates</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">composition</span><span class="p">)</span>

        <span class="n">nc</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">rate</span><span class="p">,</span> <span class="n">rval</span> <span class="ow">in</span> <span class="n">rvals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">nucs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">rate</span><span class="o">.</span><span class="n">reactants</span><span class="p">):</span>
                <span class="n">nucs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="o">-</span><span class="n">rate</span><span class="o">.</span><span class="n">reactant_count</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">rval</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">rate</span><span class="o">.</span><span class="n">products</span><span class="p">):</span>
                <span class="n">nucs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">rate</span><span class="o">.</span><span class="n">product_count</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">rval</span><span class="p">))</span>
            <span class="n">nc</span><span class="p">[</span><span class="n">rate</span><span class="p">]</span> <span class="o">=</span> <span class="n">nucs</span>

        <span class="k">return</span> <span class="n">nc</span>

<div class="viewcode-block" id="RateCollection.network_overview">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.network_overview">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">network_overview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a verbose network overview showing for each nucleus</span>
<span class="sd">        which rates consume it and which produce it.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ostr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">:</span>
            <span class="n">ostr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">ostr</span> <span class="o">+=</span> <span class="s2">&quot;  consumed by:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_consumed</span><span class="p">[</span><span class="n">n</span><span class="p">]:</span>
                <span class="n">ostr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;     </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">string</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="n">ostr</span> <span class="o">+=</span> <span class="s2">&quot;  produced by:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_produced</span><span class="p">[</span><span class="n">n</span><span class="p">]:</span>
                <span class="n">ostr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;     </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">string</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="n">ostr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">ostr</span></div>


<div class="viewcode-block" id="RateCollection.rate_pair_overview">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.rate_pair_overview">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">rate_pair_overview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a verbose network overview in terms of</span>
<span class="sd">        forward-reverse pairs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ostr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">:</span>
            <span class="n">ostr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">rp</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_rate_pairs</span><span class="p">[</span><span class="n">n</span><span class="p">]):</span>
                <span class="n">ostr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;     </span><span class="si">{</span><span class="n">rp</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">ostr</span></div>


<div class="viewcode-block" id="RateCollection.get_nuclei_latex_string">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.get_nuclei_latex_string">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_nuclei_latex_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string listing the nuclei in latex format</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ostr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">):</span>
            <span class="n">ostr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">n</span><span class="o">.</span><span class="n">pretty</span><span class="si">}</span><span class="s2">$&quot;</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">ostr</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span>
        <span class="k">return</span> <span class="n">ostr</span></div>


<div class="viewcode-block" id="RateCollection.get_rates_latex_table_string">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.get_rates_latex_table_string">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_rates_latex_table_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string giving the rows of a LaTeX table with</span>
<span class="sd">        forward rates in the first column and reverse rates in the</span>
<span class="sd">        second column.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ostr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">rp</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_rate_pairs</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">rp</span><span class="o">.</span><span class="n">forward</span><span class="p">:</span>
                <span class="n">ostr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rp</span><span class="o">.</span><span class="n">forward</span><span class="o">.</span><span class="n">pretty_string</span><span class="si">:</span><span class="s2">38</span><span class="si">}</span><span class="s2"> &amp; </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ostr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="si">:</span><span class="s2">38</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> &amp;&quot;</span>

            <span class="k">if</span> <span class="n">rp</span><span class="o">.</span><span class="n">reverse</span><span class="p">:</span>
                <span class="n">ostr</span> <span class="o">+=</span> <span class="sa">rf</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">rp</span><span class="o">.</span><span class="n">reverse</span><span class="o">.</span><span class="n">pretty_string</span><span class="si">:</span><span class="s2">38</span><span class="si">}</span><span class="s2"> </span><span class="se">\\</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ostr</span> <span class="o">+=</span> <span class="sa">rf</span><span class="s2">&quot;  </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="si">:</span><span class="s2">38</span><span class="si">}</span><span class="s2"> </span><span class="se">\\</span><span class="s2">&quot;</span>

            <span class="n">ostr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">ostr</span></div>


<div class="viewcode-block" id="RateCollection.write_network">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.write_network">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write out the network.  For :py:class:`RateCollection`</span>
<span class="sd">        this is a no-op.  But derived classes will use this to</span>
<span class="sd">        create the network in a file (or files).</span>

<span class="sd">        We do a find check here that the rates in the network</span>
<span class="sd">        are distinguishable.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distinguishable_rates</span><span class="p">(),</span> <span class="s2">&quot;ERROR: Rates not uniquely identified by Rate.fname&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_network</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_distinguishable_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Every Rate in this RateCollection should have a unique</span>
<span class="sd">        Rate.fname, as the network writers distinguish the rates on</span>
<span class="sd">        this basis.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">fname</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">):</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">names</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found rate </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s1"> named </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> with </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1"> entries in the RateCollection.&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rate </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s1"> has the original source:</span><span class="se">\n</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">original_source</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rate </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s1"> is in chapter </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">chapter</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_write_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A stub for function to output the network -- this is</span>
<span class="sd">        implementation dependent.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pylint: disable=unused-argument</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;To create network integration source code, use a class that implements a specific network type.&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="RateCollection.create_network_graph">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.create_network_graph">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_network_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_nuclei</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                             <span class="n">nuclei_custom_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">rotated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">rate_ydots</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ydot_cutoff_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">consuming_rate_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">show_small_ydot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">hide_xalpha</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hide_xp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">rate_filter_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">highlight_filter_function</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a graph representation of the network using</span>
<span class="sd">        NetworkX.  This arranges the nuclei as nodes on a grid</span>
<span class="sd">        determined by their N and Z, and creates the edges that</span>
<span class="sd">        connect the nuclei.  The various parameters control how</span>
<span class="sd">        which edges are present and their weights.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_nuclei : Iterable(Nucleus)</span>
<span class="sd">            the nuclei to represent as nodes in the graph</span>
<span class="sd">        nuclei_custom_labels : dict(Nucleus, str)</span>
<span class="sd">            a dictionary giving alternate labels for the nodes.  If not present</span>
<span class="sd">            the nuclei&#39;s isotope symbol is used.</span>
<span class="sd">        rotated : bool</span>
<span class="sd">            arrange the nodes as A - 2Z vs. Z or the default Z vs. N?</span>
<span class="sd">        rate_ydots : dict(Rate)</span>
<span class="sd">            the contribution of each rate to a nuclei&#39;s dY/dt evolution.</span>
<span class="sd">            This can be obtained from :py:meth:`.evaluate_rates`</span>
<span class="sd">        ydot_cutoff_value : float</span>
<span class="sd">            rate threshold below which we do not add an edge connecting</span>
<span class="sd">            nuclei.</span>
<span class="sd">        consuming_rate_threshold : float</span>
<span class="sd">            for a nucleus that has multiple rates that consume it, remove</span>
<span class="sd">            any rates that are ``consuming_rate_threshold`` smaller than</span>
<span class="sd">            the fastest rate consuming the nucleus.</span>
<span class="sd">        show_small_ydot : bool</span>
<span class="sd">            create edges for rates below ``ydot_cutoff_value``.  They will have</span>
<span class="sd">            the property &quot;real&quot; set to -1.</span>
<span class="sd">        hide_xalpha : bool</span>
<span class="sd">            don&#39;t create edges connecting alpha particles and heavy</span>
<span class="sd">            nuclei in reactions of the form A(alpha,X)B or A(X,alpha)B,</span>
<span class="sd">            except if alpha is the heaviest product.</span>
<span class="sd">        hide_xp : bool</span>
<span class="sd">            don&#39;t create edges connecting protons and heavy</span>
<span class="sd">            nuclei in reactions of the form A(p,X)B or A(X,p)B.</span>
<span class="sd">        rate_filter_function : Callable</span>
<span class="sd">            a function that takes a ``Rate`` object and returns True</span>
<span class="sd">            or False if an edge should be created for the nuclei</span>
<span class="sd">            it links.</span>
<span class="sd">        highlight_filter_function : Callable</span>
<span class="sd">            a function that takes a ``Rate`` object and returns True or</span>
<span class="sd">            False if we want to highlight the edge in the network.  This</span>
<span class="sd">            sets the &quot;highlight&quot; property of the edge.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        networkx.classes.multidigraph.MultiDiGraph</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">MultiDiGraph</span><span class="p">()</span>
        <span class="n">G</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">G</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">nuclei_custom_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nuclei_custom_labels</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node_nuclei</span><span class="p">:</span>
            <span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rotated</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">A</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nuclei_custom_labels</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuclei_custom_labels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="sa">fr</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">n</span><span class="o">.</span><span class="n">pretty</span><span class="si">}</span><span class="s2">$&quot;</span>

        <span class="c1"># Do not show rates on the graph if their corresponding ydot</span>
        <span class="c1"># is less than ydot_cutoff_value</span>
        <span class="n">invisible_rates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ydot_cutoff_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rate_ydots</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ydot_cutoff_value</span><span class="p">:</span>
                    <span class="n">invisible_rates</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

        <span class="c1"># Consider each nucleus heavier than He and all the rates that</span>
        <span class="c1"># consume it.  If desired, only show rates that are within a</span>
        <span class="c1"># threshold of the fastest rate consuming that nucleus</span>
        <span class="k">if</span> <span class="n">consuming_rate_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">consuming_rate_threshold</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node_nuclei</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">Z</span> <span class="o">&lt;=</span> <span class="mf">2.0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">consump_rates</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">reactants</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">consump_rates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">max_rate</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">rate_ydots</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">consump_rates</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">consump_rates</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">rate_ydots</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">consuming_rate_threshold</span> <span class="o">*</span> <span class="n">max_rate</span><span class="p">:</span>
                        <span class="n">invisible_rates</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

        <span class="c1"># edges for the rates that are explicitly in the network</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node_nuclei</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_consumed</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_consumed</span><span class="p">[</span><span class="n">n</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">rate_filter_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">rate_filter_function</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
                        <span class="k">continue</span>

                <span class="n">highlight</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">highlight_filter_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">highlight</span> <span class="o">=</span> <span class="n">highlight_filter_function</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">products</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_nuclei</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="n">hide_xalpha</span> <span class="ow">and</span> <span class="n">_skip_xalpha</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="n">hide_xp</span> <span class="ow">and</span> <span class="n">_skip_xp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
                        <span class="k">continue</span>

                    <span class="c1"># networkx doesn&#39;t seem to keep the edges in</span>
                    <span class="c1"># any particular order, so we associate data</span>
                    <span class="c1"># to the edges here directly, in this case,</span>
                    <span class="c1"># the reaction rate, which will be used to</span>
                    <span class="c1"># color it</span>
                    <span class="c1"># here real means that it is not an approximate rate</span>

                    <span class="k">if</span> <span class="n">rate_ydots</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">([(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)],</span> <span class="n">weight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                         <span class="n">real</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="n">highlight</span><span class="p">)</span>
                        <span class="k">continue</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">rate_weight</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rate_ydots</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="c1"># if rate_ydots[r] is zero, then set the</span>
                        <span class="c1"># weight to roughly the minimum exponent</span>
                        <span class="c1"># possible for python floats</span>
                        <span class="n">rate_weight</span> <span class="o">=</span> <span class="o">-</span><span class="mi">308</span>

                    <span class="k">if</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">invisible_rates</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">show_small_ydot</span><span class="p">:</span>
                            <span class="c1"># use real -1 for displaying rates that are below ydot_cutoff</span>
                            <span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">([(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)],</span> <span class="n">weight</span><span class="o">=</span><span class="n">rate_weight</span><span class="p">,</span>
                                             <span class="n">real</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="n">highlight</span><span class="p">)</span>

                        <span class="k">continue</span>

                    <span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">([(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)],</span> <span class="n">weight</span><span class="o">=</span><span class="n">rate_weight</span><span class="p">,</span>
                                     <span class="n">real</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="n">highlight</span><span class="p">)</span>

        <span class="c1"># now consider the rates that are approximated out of the network</span>
        <span class="n">rate_seen</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">ApproximateRate</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">sr</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">hidden_rates</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sr</span> <span class="ow">in</span> <span class="n">rate_seen</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">rate_seen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sr</span><span class="p">)</span>

                <span class="n">highlight</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">highlight_filter_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">highlight</span> <span class="o">=</span> <span class="n">highlight_filter_function</span><span class="p">(</span><span class="n">sr</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">sr</span><span class="o">.</span><span class="n">reactants</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_nuclei</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">sr</span><span class="o">.</span><span class="n">products</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node_nuclei</span><span class="p">:</span>
                            <span class="k">continue</span>

                        <span class="k">if</span> <span class="n">hide_xalpha</span> <span class="ow">and</span> <span class="n">_skip_xalpha</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">sr</span><span class="p">):</span>
                            <span class="k">continue</span>

                        <span class="k">if</span> <span class="n">hide_xp</span> <span class="ow">and</span> <span class="n">_skip_xp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">sr</span><span class="p">):</span>
                            <span class="k">continue</span>

                        <span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">([(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)],</span> <span class="n">weight</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="n">highlight</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">G</span></div>


<div class="viewcode-block" id="RateCollection.plot">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.plot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
             <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">ydot_cutoff_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show_small_ydot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">consuming_rate_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">node_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">node_font_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s2">&quot;#444444&quot;</span><span class="p">,</span> <span class="n">node_shape</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
             <span class="n">nuclei_custom_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">curved_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">N_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Z_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rotated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">always_show_p</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">always_show_alpha</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">hide_xp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hide_xalpha</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">edge_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">highlight_filter_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">nucleus_filter_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rate_filter_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">legend_coord</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a plot of the network structure showing the links between</span>
<span class="sd">        nuclei.  If a full set of thermodymamic conditions are</span>
<span class="sd">        provided (rho, T, comp), then the links are colored by rate</span>
<span class="sd">        strength.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rho : float</span>
<span class="sd">           density to evaluate rates with</span>
<span class="sd">        T : float</span>
<span class="sd">            temperature to evaluate rates with</span>
<span class="sd">        comp : Composition</span>
<span class="sd">            composition to evaluate rates with</span>
<span class="sd">        outfile : str</span>
<span class="sd">            output name of the plot (extension determines the type)</span>
<span class="sd">        size : (tuple, list)</span>
<span class="sd">            (width, height) of the plot in pixels</span>
<span class="sd">        dpi : int</span>
<span class="sd">            dots per inch used with size to set output image size</span>
<span class="sd">        title : str</span>
<span class="sd">            title to display on the plot</span>
<span class="sd">        ydot_cutoff_value : float</span>
<span class="sd">            rate threshold below which we do not show a</span>
<span class="sd">            line corresponding to a rate</span>
<span class="sd">        show_small_ydot : bool</span>
<span class="sd">            show visible dashed lines for rates below ``ydot_cutoff_value``</span>
<span class="sd">        consuming_rate_threshold : float</span>
<span class="sd">            for a nucleus that has multiple rates that consume it, remove</span>
<span class="sd">            any rates that are ``consuming_rate_threshold`` smaller than</span>
<span class="sd">            the fastest rate consuming the nucleus.</span>
<span class="sd">        node_size : float</span>
<span class="sd">            size of a node (in networkx units)</span>
<span class="sd">        node_font_size : float</span>
<span class="sd">            size of the font used to write the isotope in the node</span>
<span class="sd">        node_color : str, Callable</span>
<span class="sd">            color to make the nodes. May be a callable that takes a Nucleus</span>
<span class="sd">            object and returns a color.</span>
<span class="sd">        node_shape : str</span>
<span class="sd">            shape of the node (using matplotlib marker names)</span>
<span class="sd">        nuclei_custom_labels : dict(Nucleus, str)</span>
<span class="sd">            a dict of the form {Nucleus: str} that provides alternate</span>
<span class="sd">            labels for nodes (instead of using the `pretty` attribute</span>
<span class="sd">            of the Nucleus.</span>
<span class="sd">        curved_edges : bool</span>
<span class="sd">            do we use arcs to connect the nodes?</span>
<span class="sd">        N_range : Iterable</span>
<span class="sd">            range of neutron number to zoom in on</span>
<span class="sd">        Z_range : Iterable</span>
<span class="sd">            range of proton number to zoom in on</span>
<span class="sd">        rotate : bool</span>
<span class="sd">            plot A - 2Z vs. Z instead of the default Z vs. N</span>
<span class="sd">        always_show_p : bool</span>
<span class="sd">            include p as a node on the plot even if we</span>
<span class="sd">            don&#39;t have p+p reactions</span>
<span class="sd">        always_show_alpha : bool</span>
<span class="sd">            include He4 as a node on the plot even if</span>
<span class="sd">            we don&#39;t have 3-alpha</span>
<span class="sd">        hide_xalpha : bool</span>
<span class="sd">            don&#39;t connect the links to alpha for heavy</span>
<span class="sd">            nuclei reactions of the form A(alpha,X)B or A(X,alpha)B,</span>
<span class="sd">            except if alpha is the heaviest product.</span>
<span class="sd">        hide_xp : bool</span>
<span class="sd">            don&#39;t connect the links to p for heavy</span>
<span class="sd">            nuclei reactions of the form A(p,X)B or A(X,p)B.</span>
<span class="sd">        edge_labels : dict</span>
<span class="sd">            a dictionary of the form {(n1, n2): &quot;label&quot;}</span>
<span class="sd">            that gives labels for the edges in the network connecting</span>
<span class="sd">            nucleus n1 to n2.</span>
<span class="sd">        highlight_filter_function : Callable</span>
<span class="sd">            a function that takes a ``Rate`` object and returns True or</span>
<span class="sd">            False if we want to highlight the rate edge.</span>
<span class="sd">        nucleus_filter_function : Callable</span>
<span class="sd">            a function that takes a ``Nucleus`` object and returns</span>
<span class="sd">            True or False if it is to be shown as a node.</span>
<span class="sd">        rate_filter_function : Callable</span>
<span class="sd">            a function that takes a ``Rate`` object</span>
<span class="sd">            and returns True or False if it is to be shown as an edge.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.figure.Figure</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

        <span class="c1">#divider = make_axes_locatable(ax)</span>
        <span class="c1">#cax = divider.append_axes(&#39;right&#39;, size=&#39;15%&#39;, pad=0.05)</span>

        <span class="c1">#ax.plot([0, 0], [8, 8], &#39;b-&#39;)</span>

        <span class="c1"># in general, we do not show p, n, alpha,</span>
        <span class="c1"># unless we have p + p, 3-a, etc.</span>
        <span class="n">hidden_nuclei</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">always_show_p</span><span class="p">:</span>
            <span class="n">hidden_nuclei</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span>
            <span class="n">hidden_nuclei</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;p_nse&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">always_show_alpha</span><span class="p">:</span>
            <span class="n">hidden_nuclei</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;he4&quot;</span><span class="p">)</span>

        <span class="c1"># nodes -- the node nuclei will be all of the heavies</span>
        <span class="c1"># add all the nuclei into G.node</span>
        <span class="n">node_nuclei</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">node_color</span><span class="p">):</span>
            <span class="n">get_node_color</span> <span class="o">=</span> <span class="n">node_color</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">get_node_color</span><span class="p">(</span><span class="n">_nuc</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">node_color</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">raw</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hidden_nuclei</span><span class="p">:</span>
                <span class="n">node_nuclei</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_node_color</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># show hidden nuclei only if they react with themselves</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="p">(</span><span class="n">ApproximateRate</span><span class="p">,</span> <span class="n">ModifiedRate</span><span class="p">))</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">reactant_count</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">node_nuclei</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                        <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_node_color</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                        <span class="k">break</span>

        <span class="c1"># approx nuclei are given a different color</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">approx_nuclei</span><span class="p">:</span>
            <span class="n">node_nuclei</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#888888&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nucleus_filter_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">node_nuclei</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">nucleus_filter_function</span><span class="p">,</span> <span class="n">node_nuclei</span><span class="p">))</span>
            <span class="c1"># redo the colors:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node_nuclei</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">approx_nuclei</span><span class="p">:</span>
                    <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;#888888&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_node_color</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

        <span class="c1"># get the rates for each reaction</span>
        <span class="k">if</span> <span class="n">rho</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">T</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">comp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rate_ydots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_rates</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rate_ydots</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_network_graph</span><span class="p">(</span><span class="n">node_nuclei</span><span class="p">,</span>
                                      <span class="n">rate_ydots</span><span class="o">=</span><span class="n">rate_ydots</span><span class="p">,</span>
                                      <span class="n">ydot_cutoff_value</span><span class="o">=</span><span class="n">ydot_cutoff_value</span><span class="p">,</span>
                                      <span class="n">hide_xalpha</span><span class="o">=</span><span class="n">hide_xalpha</span><span class="p">,</span> <span class="n">hide_xp</span><span class="o">=</span><span class="n">hide_xp</span><span class="p">,</span>
                                      <span class="n">show_small_ydot</span><span class="o">=</span><span class="n">show_small_ydot</span><span class="p">,</span>
                                      <span class="n">consuming_rate_threshold</span><span class="o">=</span><span class="n">consuming_rate_threshold</span><span class="p">,</span>
                                      <span class="n">rate_filter_function</span><span class="o">=</span><span class="n">rate_filter_function</span><span class="p">,</span>
                                      <span class="n">highlight_filter_function</span><span class="o">=</span><span class="n">highlight_filter_function</span><span class="p">,</span>
                                      <span class="n">rotated</span><span class="o">=</span><span class="n">rotated</span><span class="p">,</span>
                                      <span class="n">nuclei_custom_labels</span><span class="o">=</span><span class="n">nuclei_custom_labels</span><span class="p">)</span>

        <span class="c1"># It seems that networkx broke backwards compatibility, and &#39;zorder&#39; is no longer a valid</span>
        <span class="c1"># keyword argument. The &#39;linewidth&#39; argument has also changed to &#39;linewidths&#39;.</span>

        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">position</span><span class="p">,</span>      <span class="c1"># plot the element at the correct position</span>
                               <span class="n">node_color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                               <span class="n">node_shape</span><span class="o">=</span><span class="n">node_shape</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">node_size</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span>   <span class="c1"># label the name of element at the correct position</span>
                                <span class="n">font_size</span><span class="o">=</span><span class="n">node_font_size</span><span class="p">,</span> <span class="n">font_color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

        <span class="c1"># now we&#39;ll draw edges in two groups -- real links and approximate links</span>

        <span class="k">if</span> <span class="n">curved_edges</span><span class="p">:</span>
            <span class="n">connectionstyle</span> <span class="o">=</span> <span class="s2">&quot;arc3, rad = 0.2&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">connectionstyle</span> <span class="o">=</span> <span class="s2">&quot;arc3&quot;</span>

        <span class="n">real_edges</span> <span class="o">=</span> <span class="p">[(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">real_weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">rate_ydots</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">edge_color</span> <span class="o">=</span> <span class="s2">&quot;C0&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">edge_color</span> <span class="o">=</span> <span class="n">real_weights</span>
        <span class="n">ww</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">real_weights</span><span class="p">)</span>
        <span class="n">min_weight</span> <span class="o">=</span> <span class="n">ww</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">max_weight</span> <span class="o">=</span> <span class="n">ww</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">dw</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_weight</span> <span class="o">-</span> <span class="n">min_weight</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
        <span class="n">widths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">ww</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dw</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">widths</span><span class="p">[</span><span class="n">ww</span> <span class="o">&gt;</span> <span class="n">min_weight</span> <span class="o">+</span> <span class="n">dw</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.5</span>
            <span class="n">widths</span><span class="p">[</span><span class="n">ww</span> <span class="o">&gt;</span> <span class="n">min_weight</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">dw</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.5</span>
            <span class="n">widths</span><span class="p">[</span><span class="n">ww</span> <span class="o">&gt;</span> <span class="n">min_weight</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">dw</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">widths</span> <span class="o">*=</span> <span class="mi">2</span>

        <span class="c1"># plot the arrow of reaction</span>
        <span class="n">real_edges_lc</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">widths</span><span class="p">),</span>
                                               <span class="n">edgelist</span><span class="o">=</span><span class="n">real_edges</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="n">edge_color</span><span class="p">,</span>
                                               <span class="n">connectionstyle</span><span class="o">=</span><span class="n">connectionstyle</span><span class="p">,</span>
                                               <span class="n">node_size</span><span class="o">=</span><span class="n">node_size</span><span class="p">,</span>
                                               <span class="n">edge_cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">approx_edges</span> <span class="o">=</span> <span class="p">[(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>

        <span class="n">_</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">edgelist</span><span class="o">=</span><span class="n">approx_edges</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;0.5&quot;</span><span class="p">,</span>
                                   <span class="n">connectionstyle</span><span class="o">=</span><span class="n">connectionstyle</span><span class="p">,</span>
                                   <span class="n">style</span><span class="o">=</span><span class="s2">&quot;dotted&quot;</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">node_size</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

        <span class="c1"># plot invisible rates, rates that are below ydot_cutoff_value</span>
        <span class="n">invis_edges</span> <span class="o">=</span> <span class="p">[(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;real&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">_</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">edgelist</span><span class="o">=</span><span class="n">invis_edges</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
                                   <span class="n">connectionstyle</span><span class="o">=</span><span class="n">connectionstyle</span><span class="p">,</span>
                                   <span class="n">style</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">node_size</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

        <span class="c1"># highlight edges</span>
        <span class="n">highlight_edges</span> <span class="o">=</span> <span class="p">[(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;highlight&quot;</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">rho</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># we are not coloring edges by reaction rate, so highlight in yellow</span>
            <span class="n">highlight_color</span> <span class="o">=</span> <span class="s2">&quot;yellow&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># use C0 since it doesn&#39;t blend in with viridis</span>
            <span class="n">highlight_color</span> <span class="o">=</span> <span class="s2">&quot;C0&quot;</span>

        <span class="n">_</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                   <span class="n">edgelist</span><span class="o">=</span><span class="n">highlight_edges</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="n">highlight_color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                   <span class="n">connectionstyle</span><span class="o">=</span><span class="n">connectionstyle</span><span class="p">,</span>
                                   <span class="n">node_size</span><span class="o">=</span><span class="n">node_size</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">edge_labels</span><span class="p">:</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edge_labels</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">position</span><span class="p">,</span>
                                         <span class="n">connectionstyle</span><span class="o">=</span><span class="n">connectionstyle</span><span class="p">,</span>
                                         <span class="n">font_size</span><span class="o">=</span><span class="n">node_font_size</span><span class="p">,</span>
                                         <span class="n">edge_labels</span><span class="o">=</span><span class="n">edge_labels</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rate_ydots</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">PatchCollection</span><span class="p">(</span><span class="n">real_edges_lc</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">)</span>
            <span class="n">pc</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">real_weights</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">rotated</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;log10(rate)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;log10(rate)&quot;</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rotated</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$N$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;large&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$Z$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;large&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$Z$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;large&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$A - 2Z$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;large&quot;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rotated</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Z_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">N_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">N_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">N_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">Z_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Z_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Z_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">Z_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Z_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># if we are rotated and all nuclei have Z = A, then make</span>
        <span class="c1"># the vertical axis symmetric</span>
        <span class="k">if</span> <span class="n">rotated</span><span class="p">:</span>
            <span class="n">ZA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">A</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="o">.</span><span class="n">Z</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node_nuclei</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">ZA</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">==</span> <span class="n">ZA</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ZA</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">ZA</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rotated</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="s2">&quot;datalim&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">legend_coord</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">legend_coord</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
            <span class="n">eps</span> <span class="o">=</span> <span class="mf">0.1</span>
            <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">RATE_LINES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">dZ</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">dN</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">rotated</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">legend_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">legend_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">dZ</span><span class="p">,</span> <span class="n">dN</span><span class="o">-</span><span class="n">dZ</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span>
                             <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">legend_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">dZ</span><span class="o">+</span><span class="n">eps</span><span class="p">,</span> <span class="n">legend_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">dN</span><span class="o">-</span><span class="n">dZ</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">dN</span><span class="o">-</span><span class="n">dZ</span><span class="p">)</span><span class="o">*</span><span class="n">eps</span><span class="p">,</span>
                            <span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">legend_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">legend_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                             <span class="n">dN</span><span class="p">,</span> <span class="n">dZ</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span>
                             <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">legend_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">dN</span><span class="o">+</span><span class="n">eps</span><span class="p">,</span> <span class="n">legend_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">dZ</span><span class="o">+</span><span class="n">eps</span><span class="p">,</span>
                            <span class="n">label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">dpi</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">dpi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="RateCollection.plot_jacobian">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.plot_jacobian">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_jacobian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                      <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">screen_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">rate_scaling</span><span class="o">=</span><span class="mf">1.e10</span><span class="p">,</span>
                      <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">800</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot the Jacobian matrix of the system.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rho : float</span>
<span class="sd">            density used to evaluate terms</span>
<span class="sd">        T : float</span>
<span class="sd">            temperature used to evaluate terms</span>
<span class="sd">        comp : Composition</span>
<span class="sd">            composition used to evaluate terms</span>
<span class="sd">        outfile : str</span>
<span class="sd">            output file for plot (extension is used to specify file type)</span>
<span class="sd">        rate_scaling : float</span>
<span class="sd">            the cutoff of values that we show, relative to the peak.  Any</span>
<span class="sd">            Jacobian element smaller than this will not be shown.</span>
<span class="sd">        size : (tuple, list)</span>
<span class="sd">            size in pixels for the output plot</span>
<span class="sd">        dpi : float</span>
<span class="sd">            dots per inch for the output plot</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.figure.Figure</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">jac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_jacobian</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">screen_func</span><span class="o">=</span><span class="n">screen_func</span><span class="p">)</span>

        <span class="n">valid_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">jac</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="c1"># pylint: disable-next=redundant-keyword-arg</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">SymLogNorm</span><span class="p">(</span><span class="n">valid_max</span><span class="o">/</span><span class="n">rate_scaling</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">valid_max</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">valid_max</span><span class="p">)</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">dpi</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">dpi</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">)),</span>
                      <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">n</span><span class="o">.</span><span class="n">pretty</span><span class="si">}</span><span class="s2">$&quot;</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">)),</span>
                      <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">n</span><span class="o">.</span><span class="n">pretty</span><span class="si">}</span><span class="s2">$&quot;</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">])</span>

        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">jac</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bwr</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>

        <span class="c1"># Turn spines off and create white grid.</span>
        <span class="c1">#ax.spines[:].set_visible(False)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">jac</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">jac</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="RateCollection.plot_network_chart">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.plot_network_chart">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_network_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                           <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">800</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">force_one_column</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot a heatmap showing which rates are affected by which nuclei.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rho : float</span>
<span class="sd">            density used to evaluate rates</span>
<span class="sd">        T : float</span>
<span class="sd">            temperature used to evaluate rates</span>
<span class="sd">        comp : Composition</span>
<span class="sd">            composition used to evaluate rates</span>
<span class="sd">        outfile</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.figure.Figure</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_network_chart</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span>

        <span class="c1"># find the limits</span>
        <span class="n">_ydot</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">nc</span><span class="p">[</span><span class="n">r</span><span class="p">]:</span>
                <span class="n">_ydot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="n">_ydot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">_ydot</span><span class="p">)</span>
        <span class="n">valid_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">_ydot</span><span class="p">[</span><span class="n">_ydot</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="c1"># pylint: disable-next=redundant-keyword-arg</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">SymLogNorm</span><span class="p">(</span><span class="n">valid_max</span><span class="o">/</span><span class="mf">1.e15</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">valid_max</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">valid_max</span><span class="p">)</span>

        <span class="c1"># if there are a lot of rates, we split the network chart into</span>
        <span class="c1"># two side-by-side panes, with the first half of the rates on</span>
        <span class="c1"># the left and the second half of the rates on the right</span>

        <span class="c1"># how many panes?</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">):</span>
            <span class="n">npanes</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">npanes</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">force_one_column</span><span class="p">:</span>
            <span class="n">npanes</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">npanes</span><span class="p">,</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">dpi</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">dpi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">npanes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">drate</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">drate</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="n">_rates</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ipane</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npanes</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">npanes</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">_ax</span><span class="p">[</span><span class="n">ipane</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">_ax</span>

            <span class="n">istart</span> <span class="o">=</span> <span class="n">ipane</span> <span class="o">*</span> <span class="n">drate</span>
            <span class="n">iend</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">ipane</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">drate</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">nrates</span> <span class="o">=</span> <span class="n">iend</span> <span class="o">-</span> <span class="n">istart</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nrates</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

            <span class="c1"># loop over rates -- each rate is a line in a grid of nuclei vs rate</span>

            <span class="c1">#ax = grid[ipane]</span>

            <span class="k">for</span> <span class="n">irate</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_rates</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">istart</span> <span class="o">&lt;=</span> <span class="n">irate</span> <span class="o">&lt;=</span> <span class="n">iend</span><span class="p">:</span>
                    <span class="n">irow</span> <span class="o">=</span> <span class="n">irate</span> <span class="o">-</span> <span class="n">istart</span>
                    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">ydot</span> <span class="ow">in</span> <span class="n">nc</span><span class="p">[</span><span class="n">r</span><span class="p">]:</span>
                        <span class="n">icol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="n">irow</span><span class="p">,</span> <span class="n">icol</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">irow</span><span class="p">,</span> <span class="n">icol</span><span class="p">]</span> <span class="o">=</span> <span class="n">ydot</span>

            <span class="c1"># each pane has all the nuclei</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">)),</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">n</span><span class="o">.</span><span class="n">pretty</span><span class="si">}</span><span class="s2">$&quot;</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

            <span class="c1"># each pane only has its subset of rates</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nrates</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">pretty_string</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">irate</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_rates</span><span class="p">)</span> <span class="k">if</span> <span class="n">istart</span> <span class="o">&lt;=</span> <span class="n">irate</span> <span class="o">&lt;=</span> <span class="n">iend</span><span class="p">])</span>

            <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">bwr</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>

            <span class="c1"># Turn spines off and create white grid.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[:]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">npanes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_safelog</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">small</span><span class="p">):</span>

        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">arr</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Negative values not allowed for logscale - try symlog instead.&quot;</span><span class="p">)</span>
        <span class="n">zeros</span> <span class="o">=</span> <span class="n">arr</span> <span class="o">==</span> <span class="mf">0.0</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">zeros</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">small</span><span class="p">,</span> <span class="n">arr</span><span class="p">[</span><span class="o">~</span><span class="n">zeros</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_symlog</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">linthresh</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">linscale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>

        <span class="n">symlog_transform</span> <span class="o">=</span> <span class="n">SymmetricalLogTransform</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">linthresh</span><span class="p">,</span> <span class="n">linscale</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">symlog_transform</span><span class="o">.</span><span class="n">transform_non_affine</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">arr</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_scale</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">minval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">minval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">minval</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">maxval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">maxval</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">minval</span> <span class="o">!=</span> <span class="n">maxval</span><span class="p">:</span>
            <span class="n">scaled</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">minval</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">maxval</span> <span class="o">-</span> <span class="n">minval</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="n">scaled</span><span class="p">[</span><span class="n">scaled</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">scaled</span><span class="p">[</span><span class="n">scaled</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">return</span> <span class="n">scaled</span>

<div class="viewcode-block" id="RateCollection.gridplot">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.RateCollection.gridplot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gridplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color_field</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plot nuclides as cells on a grid of Z vs. N, colored by `color_field`.</span>
<span class="sd">        If called without a composition, the function will just plot the grid</span>
<span class="sd">        with no color field.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rho : float</span>
<span class="sd">            density used to evaluate color_field</span>
<span class="sd">        T : float</span>
<span class="sd">            temperature used to evaluate color_field</span>
<span class="sd">        comp : Composition</span>
<span class="sd">            composition used to evaluate color_field</span>
<span class="sd">        color_field : str</span>
<span class="sd">            field to color by. Must be one of &#39;X&#39; (mass fraction),</span>
<span class="sd">            &#39;Y&#39; (molar abundance), &#39;Xdot&#39; (time derivative of X), &#39;Ydot&#39; (time</span>
<span class="sd">            derivative of Y), or &#39;activity&#39; (sum of contributions to Ydot of</span>
<span class="sd">            all rates, ignoring sign).</span>
<span class="sd">        scale : str</span>
<span class="sd">            One of &#39;linear&#39;, &#39;log&#39;, and &#39;symlog&#39;. Linear by default.</span>
<span class="sd">        small : float</span>
<span class="sd">            If using logarithmic scaling, zeros will be replaced with</span>
<span class="sd">            this value. 1e-30 by default.</span>
<span class="sd">        linthresh : float</span>
<span class="sd">            Linearity threshold for symlog scaling.</span>
<span class="sd">        linscale : float</span>
<span class="sd">            The number of decades to use for each half of the linear</span>
<span class="sd">            range. Stretches linear range relative to the logarithmic range.</span>
<span class="sd">        filter_function : Callable</span>
<span class="sd">            A callable to filter :py:class:`Nucleus &lt;pynucastro.nucdata.nucleus.Nucleus&gt;`</span>
<span class="sd">            objects with. Should return `True` if the nuclide should be plotted.</span>
<span class="sd">        outfile : str</span>
<span class="sd">            Output file to save the plot to. The plot will be shown if</span>
<span class="sd">            not specified.</span>
<span class="sd">        dpi : float</span>
<span class="sd">            DPI to save the image file at.</span>
<span class="sd">        cmap : str</span>
<span class="sd">            Name of the matplotlib colormap to use. Default is &#39;magma&#39;.</span>
<span class="sd">        edgecolor : str</span>
<span class="sd">            Color of grid cell edges.</span>
<span class="sd">        area : float</span>
<span class="sd">            Area of the figure without the colorbar, in square inches. 64</span>
<span class="sd">            by default.</span>
<span class="sd">        no_axes : bool</span>
<span class="sd">            Set to True to omit axis spines.</span>
<span class="sd">        no_ticks : bool</span>
<span class="sd">            Set to True to omit tickmarks.</span>
<span class="sd">        no_cbar : bool</span>
<span class="sd">            Set to True to omit colorbar.</span>
<span class="sd">        cbar_label : str</span>
<span class="sd">            Colorbar label.</span>
<span class="sd">        cbar_bounds : list, tuple</span>
<span class="sd">             Explicit colorbar bounds.</span>
<span class="sd">        cbar_format : str, matplotlib.ticker.Formatter</span>
<span class="sd">             Format string or formatter object for the colorbar ticks.</span>
<span class="sd">        cbar_ticks : int</span>
<span class="sd">             Number of ticks to use on the colorbar</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        matplotlib.figure.Figure</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Process kwargs</span>
        <span class="n">outfile</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;outfile&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="s2">&quot;viridis&quot;</span><span class="p">)</span>
        <span class="n">edgecolor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;edgecolor&quot;</span><span class="p">,</span> <span class="s2">&quot;grey&quot;</span><span class="p">)</span>
        <span class="n">small</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;small&quot;</span><span class="p">,</span> <span class="mf">1e-30</span><span class="p">)</span>
        <span class="n">area</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;area&quot;</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
        <span class="n">no_axes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;no_axes&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">no_ticks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;no_ticks&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">no_cbar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;no_cbar&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">cbar_label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cbar_label&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cbar_format</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cbar_format&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cbar_bounds</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cbar_bounds&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">filter_function</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;filter_function&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">dpi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;dpi&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">linthresh</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;linthresh&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">linscale</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;linscale&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">cbar_ticks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;cbar_ticks&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unrecognized keyword arguments: </span><span class="si">{</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Get figure, colormap</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>

        <span class="c1"># Get nuclei and all 3 numbers</span>
        <span class="n">nuclei</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_nuclei</span>
        <span class="k">if</span> <span class="n">filter_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nuclei</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">filter_function</span><span class="p">,</span> <span class="n">nuclei</span><span class="p">))</span>
        <span class="n">Ns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">N</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nuclei</span><span class="p">])</span>
        <span class="n">Zs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">Z</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nuclei</span><span class="p">])</span>
        <span class="n">As</span> <span class="o">=</span> <span class="n">Ns</span> <span class="o">+</span> <span class="n">Zs</span>

        <span class="c1"># Compute weights</span>
        <span class="n">color_field</span> <span class="o">=</span> <span class="n">color_field</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">color_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;ydot&quot;</span><span class="p">,</span> <span class="s2">&quot;xdot&quot;</span><span class="p">,</span> <span class="s2">&quot;activity&quot;</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid color field: &#39;</span><span class="si">{</span><span class="n">color_field</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">comp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nuclei</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">color_field</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>

            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">comp</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span> <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">nuclei</span><span class="p">])</span>

        <span class="k">elif</span> <span class="n">color_field</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>

            <span class="n">ys</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get_molar</span><span class="p">()</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ys</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span> <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">nuclei</span><span class="p">])</span>

        <span class="k">elif</span> <span class="n">color_field</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;ydot&quot;</span><span class="p">,</span> <span class="s2">&quot;xdot&quot;</span><span class="p">}:</span>

            <span class="k">if</span> <span class="n">rho</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">T</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Need both rho and T to evaluate rates!&quot;</span><span class="p">)</span>
            <span class="n">ydots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_ydots</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ydots</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span> <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">nuclei</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">color_field</span> <span class="o">==</span> <span class="s2">&quot;xdot&quot;</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">*=</span> <span class="n">As</span>

        <span class="k">elif</span> <span class="n">color_field</span> <span class="o">==</span> <span class="s2">&quot;activity&quot;</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">rho</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">T</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Need both rho and T to evaluate rates!&quot;</span><span class="p">)</span>
            <span class="n">act</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_activity</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">act</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span> <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">nuclei</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_safelog</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">small</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;symlog&quot;</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_symlog</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">linthresh</span><span class="p">,</span> <span class="n">linscale</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cbar_bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cbar_bounds</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="o">*</span><span class="n">cbar_bounds</span><span class="p">)</span>

        <span class="c1"># Plot a square for each nucleus</span>
        <span class="k">for</span> <span class="n">nuc</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nuclei</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>

            <span class="n">square</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">nuc</span><span class="o">.</span><span class="n">N</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">nuc</span><span class="o">.</span><span class="n">Z</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">facecolor</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">weight</span><span class="p">),</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">square</span><span class="p">)</span>

        <span class="c1"># Set limits</span>
        <span class="n">maxN</span><span class="p">,</span> <span class="n">minN</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Ns</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">Ns</span><span class="p">)</span>
        <span class="n">maxZ</span><span class="p">,</span> <span class="n">minZ</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Zs</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">Zs</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">minN</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">maxN</span> <span class="o">+</span> <span class="mf">0.6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">minZ</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">maxZ</span> <span class="o">+</span> <span class="mf">0.6</span><span class="p">)</span>

        <span class="c1"># Set plot appearance</span>
        <span class="n">rat</span> <span class="o">=</span> <span class="p">(</span><span class="n">maxN</span> <span class="o">-</span> <span class="n">minN</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">maxZ</span> <span class="o">-</span> <span class="n">minZ</span><span class="p">)</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">area</span> <span class="o">*</span> <span class="n">rat</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">area</span> <span class="o">/</span> <span class="n">width</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;N $\rightarrow$&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Z $\rightarrow$&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">no_axes</span> <span class="ow">or</span> <span class="n">no_ticks</span><span class="p">:</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span>
                <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>
                <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>
                <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">no_axes</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Colorbar stuff</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">no_cbar</span> <span class="ow">and</span> <span class="n">comp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;3.5%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;symlog&quot;</span><span class="p">:</span>
                <span class="n">cbar_norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">SymLogNorm</span><span class="p">(</span><span class="n">linthresh</span><span class="p">,</span> <span class="n">linscale</span><span class="p">,</span> <span class="o">*</span><span class="n">cbar_bounds</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cbar_norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="o">*</span><span class="n">cbar_bounds</span><span class="p">)</span>

            <span class="n">smap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">cbar_norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">cbar_label</span><span class="p">:</span>

                <span class="n">capfield</span> <span class="o">=</span> <span class="n">color_field</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span><span class="p">:</span>
                    <span class="n">cbar_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;log[</span><span class="si">{</span><span class="n">capfield</span><span class="si">}</span><span class="s2">]&quot;</span>
                <span class="k">elif</span> <span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;symlog&quot;</span><span class="p">:</span>
                    <span class="n">cbar_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;symlog[</span><span class="si">{</span><span class="n">capfield</span><span class="si">}</span><span class="s2">]&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cbar_label</span> <span class="o">=</span> <span class="n">capfield</span>

            <span class="c1"># set number of ticks</span>
            <span class="k">if</span> <span class="n">cbar_ticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tick_locator</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">nbins</span><span class="o">=</span><span class="n">cbar_ticks</span><span class="p">)</span>
                <span class="n">tick_labels</span> <span class="o">=</span> <span class="n">tick_locator</span><span class="o">.</span><span class="n">tick_values</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

                <span class="c1"># for some reason tick_locator doesn&#39;t give the label of the first tick</span>
                <span class="c1"># add them manually</span>
                <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;symlog&quot;</span><span class="p">:</span>
                    <span class="n">tick_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tick_labels</span><span class="p">,</span> <span class="p">[</span><span class="n">linthresh</span><span class="p">,</span> <span class="o">-</span><span class="n">linthresh</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">cbar_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">cbar_format</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.3g</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">tick_labels</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">smap</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">tick_labels</span><span class="p">,</span>
                         <span class="n">label</span><span class="o">=</span><span class="n">cbar_label</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">cbar_format</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rates</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">string</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">string</span></div>



<div class="viewcode-block" id="Explorer">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.Explorer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Explorer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A simple class that enables interactive exploration a RateCollection,</span>
<span class="sd">    presenting density and temperature sliders to update the reaction rate</span>
<span class="sd">    values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rc : RateCollection</span>
<span class="sd">        The RateCollection we will visualize.</span>
<span class="sd">    comp : Composition</span>
<span class="sd">        A composition that will be used for evaluating the rates</span>
<span class="sd">    kwargs : dict</span>
<span class="sd">        Additional parameters that will be passed through to the</span>
<span class="sd">        RateCollection plot() function.  Note that &quot;T&quot; and &quot;rho&quot;</span>
<span class="sd">        will be ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; take a RateCollection and a composition &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rc</span> <span class="o">=</span> <span class="n">rc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="n">comp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="c1"># we will override any T and rho passed in</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_make_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logrho</span><span class="p">,</span> <span class="n">logT</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rho</span><span class="o">=</span><span class="mf">10.0</span><span class="o">**</span><span class="n">logrho</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">10.0</span><span class="o">**</span><span class="n">logT</span><span class="p">,</span>
                     <span class="n">comp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="Explorer.explore">
<a class="viewcode-back" href="../../../pynucastro.networks.rate_collection.html#pynucastro.networks.rate_collection.Explorer.explore">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">explore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logrho</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">logT</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the interactive visualization.  This uses ipywidgets.interact</span>
<span class="sd">        to create an interactive visualization.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        logrho : list, tuple</span>
<span class="sd">            a tuple of (starting log(rho), ending log(rho), dlogrho) that</span>
<span class="sd">            defines the range of densities to explore with an interactive</span>
<span class="sd">            slider.</span>
<span class="sd">        logT : list, tuple</span>
<span class="sd">            a tuple of (starting log(T), ending log(T), dlogT) that</span>
<span class="sd">            defines the range of temperatures to explore with an interactive</span>
<span class="sd">            slider.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">interact</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_plot</span><span class="p">,</span> <span class="n">logrho</span><span class="o">=</span><span class="n">logrho</span><span class="p">,</span> <span class="n">logT</span><span class="o">=</span><span class="n">logT</span><span class="p">)</span></div>
</div>

</pre></div>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By pynucastro development team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024-2025, pynucastro development team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>